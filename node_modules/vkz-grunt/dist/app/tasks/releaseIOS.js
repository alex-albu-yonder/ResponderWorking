module.exports = function (grunt) {

    grunt.registerTask('releaseIOS', 'Creates a release version including the IOS application (.ipa) for installation on IOS devices', function () {
        var appName = grunt.config.data.appName;
        var buildDir = process.cwd();
        var profile = "/Users/Devmac/Library/MobileDevice/Provisioning Profiles/" + grunt.config.data.iosConfig.profile + ".mobileprovision";
        var versionNumber = grunt.config('config').version;
        var currentdate = new Date();
        var datetime = currentdate.getDate() + "-" + (currentdate.getMonth() + 1) + "-" + currentdate.getFullYear() + " @ " + currentdate.getHours() + "h-" + currentdate.getMinutes() + "m-" + currentdate.getSeconds() + "s";
        var createCMD = 'xcrun -sdk iphoneos PackageApplication "' + buildDir + '/platforms/ios/build/device/' + appName + '.app" -o "' + buildDir + '/dist/ios/' + datetime + '/Intaker v' + versionNumber + '.ipa" --embed "' + profile + '" --sign "Verklizan B.V."';

        grunt.task.run('release');
        grunt.task.run('shell:execute:"node_modules/.bin/cordova" prepare ios');
        grunt.task.run('shell:releaseIOSCordova');
        grunt.task.run('mkdir:addIOSReleaseFolder:' + datetime);
        //Create ipa
        grunt.task.run('shell:execute:' + createCMD);
    });

};
