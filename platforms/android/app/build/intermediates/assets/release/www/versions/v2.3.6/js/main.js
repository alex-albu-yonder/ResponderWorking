/*! Responder 27-03-2019 */
angular.module("verklizan.umox.mobile",["verklizan.umox.mobile.common","verklizan.umox.mobile.account","verklizan.umox.mobile.userInfo","verklizan.umox.mobile.subscriber","verklizan.umox.mobile.careRequests","verklizan.umox.mobile.messages","ui.map","ui.event","ngRoute","ngSanitize","verklizan.umox.mobile.shared.constants","verklizan.umox.common.html5.vkz-utilities","verklizan.umox.common.html5.vkz-angular-cordova","verklizan.umox.common.html5.vkz-webrequests"]),angular.module("verklizan.umox.mobile.common",["verklizan.umox.mobile.userInfo"]),angular.module("verklizan.umox.mobile.account",["verklizan.umox.mobile.common"]),angular.module("verklizan.umox.mobile.userInfo",["verklizan.umox.mobile.common"]),angular.module("verklizan.umox.mobile.subscriber",["verklizan.umox.mobile.common"]),angular.module("verklizan.umox.mobile.careRequests",["verklizan.umox.mobile.common"]),angular.module("verklizan.umox.mobile.messages",["verklizan.umox.mobile.common"]),angular.module("verklizan.umox.mobile.account").controller("changePasswordController",["$scope","$routeParams","userDataManager","navigationService","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";a.isSubmitted=!1,a.usernameRetrieved=!1,a.formData={username:"",oldPassword:"",newPassword:""},a.$on("$viewContentLoaded",function(){var b=c.getUserName();"undefined"!=typeof b&&(a.usernameRetrieved=!0,a.formData.username=b)}),a.changePassword=function(){if(a.changePasswordForm.$invalid)return void(a.isSubmitted=!0);var b=c.changePassword(a.formData.username,a.formData.oldPassword,a.formData.newPassword).then(f);e.addLoadingPromise(b)};var f=function(){d.goBack()}}]),angular.module("verklizan.umox.mobile.account").controller("loginController",["$scope","$routeParams","pushNotificationSettingsService","loginServiceWrapper","navigationService","userDataManager","settingsService","config","organizationSettingsService","RejectedResult","USER_ROLES",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(){var b=h.security.standardCredentials;angular.isDefined(b)?(a.username=b.username,a.password=b.password):a.username=g.getLastUsedUsername()}function m(){window.isNullOrUndefined(a.appearanceSettings)&&(a.appearanceSettings={BannerVisible:!0})}a.username=null,a.password=null,a.invalid=!1,a.localizedErrorMessage="",a.loading=!1,a.appearanceSettings=g.getAppearanceSettings(),function(){l(),m(),"careRequestReceived"===b.action?a.localizedErrorMessage="_Alerts_PushNavigateLoggedOut_":"authError"===b.action?a.localizedErrorMessage="_Alerts_NotAuthorized_":"tokenExpired"===b.action&&(a.localizedErrorMessage="_Alerts_TokenExpired_")}(),a.$on("login",function(){a.loading=!1,f.sessionIsFreshStart()||c.getCareRequestReceived()?p():e.goBack()}),a.$on("$routeChangeStart",function(a,b,c){"/loading/:loadingMessage"!==b.originalPath&&f.setBackStackOfSessionAvailable(!1)}),a.login=function(){o(),a.username&&a.password&&(a.loading=!0,d.login(a.username,a.password).then(n).catch(q))},a.navigate=function(a){e.navigate(a)},a.createBase64String=function(){return"data:"+a.appearanceSettings.LogoMimeType+";base64,"+a.appearanceSettings.LogoBase64};var n=function(){o(),i.getSaveUsernameAfterLoginInResponder()?g.setLastUsedUsername(a.username):g.clearLastUsedUsername()},o=function(){a.invalid=!1,a.localizedErrorMessage=""},p=function(){var a=f.getCurrentUserRole();switch(a){case k.caregiver:e.navigate("/home");break;case k.operator:e.navigate("/settings")}},q=function(b){a.loading=!1,console.error(JSON.stringify(b)),angular.isUndefined(b.errorIsHandled)&&(a.invalid=!0),b instanceof j&&b.hasLocalizedMessage()&&(a.localizedErrorMessage=b.message)}}]),angular.module("verklizan.umox.mobile.account").controller("requestResetPasswordController",["$scope","userDataManager","loadingScreenService","navigationService","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";a.username="",a.isSubmitted=!1,a.sendResetPasswordRequest=function(c){if(a.forgotPasswordForm.$invalid)return void(a.isSubmitted=!0);var d=b.requestPasswordReset(c).then(f);e.addLoadingPromise(d)};var f=function(){c.startAndReplaceLoadingWithTimeout(2e3,g,"_Loading_PasswordResetNavigation_")},g=function(){d.navigateAndReplace("/accountPages/resetPassword")}}]),angular.module("verklizan.umox.mobile.account").controller("resetPasswordController",["$scope","$routeParams","userDataManager","loadingScreenService","navigationService","promiseLoadingSpinnerService",function(a,b,c,d,e,f){"use strict";a.isSubmitted=!1,a.formData={username:"",password:"",passwordReentered:"",activationCode:b.activationCodes},a.resetPassword=function(){if(a.resetPasswordForm.$invalid)return void(a.isSubmitted=!0);var b=c.resetPassword(a.formData.username,a.formData.password,a.formData.activationCode).then(g);f.addLoadingPromise(b)};var g=function(){d.startAndReplaceLoadingWithTimeout(2e3,h,"__Loading_PasswordResetSuccessfull__")},h=function(){e.navigateAndReplace("/login")}}]),angular.module("verklizan.umox.mobile.account").service("hashService",function(){"use strict";function a(a){function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a>>>b|a<<32-b}function d(a,b){return a>>>b}function e(a,b,c){return a&b^~a&c}function f(a,b,c){return a&b^a&c^b&c}function g(a){return c(a,2)^c(a,13)^c(a,22)}function h(a){return c(a,6)^c(a,11)^c(a,25)}function i(a){return c(a,7)^c(a,18)^d(a,3)}function j(a){return c(a,17)^c(a,19)^d(a,10)}function k(a,c){var d,k,l,m,n,o,p,q,r,s,t=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),u=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),v=new Array(64);a[c>>5]|=128<<24-c%32,a[(c+64>>9<<4)+15]=c;for(var w=0;w<a.length;w+=16){d=u[0],k=u[1],l=u[2],m=u[3],n=u[4],o=u[5],p=u[6],q=u[7];for(var x=0;x<64;x++)x<16?v[x]=a[x+w]:v[x]=b(b(b(j(v[x-2]),v[x-7]),i(v[x-15])),v[x-16]),r=b(b(b(b(q,h(n)),e(n,o,p)),t[x]),v[x]),s=b(g(d),f(d,k,l)),q=p,p=o,o=n,n=b(m,r),m=l,l=k,k=d,d=b(r,s);u[0]=b(d,u[0]),u[1]=b(k,u[1]),u[2]=b(l,u[2]),u[3]=b(m,u[3]),u[4]=b(n,u[4]),u[5]=b(o,u[5]),u[6]=b(p,u[6]),u[7]=b(q,u[7])}return u}function l(a){for(var b=[],c=(1<<o)-1,d=0;d<a.length*o;d+=o)b[d>>5]|=(a.charCodeAt(d/o)&c)<<24-d%32;return b}function m(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}function n(a){for(var b=p?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c}var o=8,p=0;return a=m(a),n(k(l(a),a.length*o))}this.CreatePasswordHash=function(b,c){var d=b.toLowerCase(),e=a(c),f=a(e+d),g=a(c+f);return g}}),angular.module("verklizan.umox.mobile.account").service("loginServiceWrapper",["$rootScope","$q","securityTokenService","hashService","userDataManager","organizationSettingsService","supportingDataManager","appVersionLoader","loginServiceProxy","moduleAuthorizationService","authorizationModuleConstants","localizedNotificationService","RejectedResult",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=this;this.login=function(a,b){var c=d.CreatePasswordHash(a,b);return e.resetCurrentOperator(),i.login(a,c).then(o)},this.logout=function(){return i.logout().catch(q).finally(p)},this.initializeLoginIfTokenIsPresent=function(){return c.tokenIsPresent()?(console.log("Token is present"),r()):b.reject("No token present")};var o=function(a){var d=a.data.LoginResult;return d===!0?(console.log("login succeeded: "+d),c.setToken(a.headers("Identity")),h.tryLoadingCorrectAppVersion().catch(function(){var a=f.loadOrganizationSettings(),c=e.readCurrentOperator();return b.all([a,c]).then(function(){var a=j.getModules();return a[k.Responder].IsAuthorized===!1?(n.logout(),b.reject(new m(!0,null,"_Login_NoModuleAuthorization_",!0))):(s(),void g.init())}).catch(function(a){return console.log(a),b.reject(new m(!0,null,"_Login_NotACaregiver_",!0))})})):b.reject(new Error("Failed to login"))},p=function(a){c.removeToken(),e.resetCurrentOperator()},q=function(a){console.log("logout error: "+JSON.stringify(a))},r=function(){return e.readCurrentOperator().then(function(){s(),g.init()})},s=function(){a.$broadcast("login")}}]),angular.module("verklizan.umox.mobile.account").constant("USER_ROLES",{all:"*",empty:"empty",operator:"operator",caregiver:"caregiver",installer:"installer"}),angular.module("verklizan.umox.mobile").config(["$routeProvider","$httpProvider","$compileProvider","USER_ROLES","settingsServiceProvider","localisationServiceProvider","moduleAuthorizationServiceProvider","authorizationModuleConstants","config","umoxServiceUrlsProvider",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={currentAccount:["$q","userDataManager","organizationSettingsService",function(a,b,c){var d=b.readCurrentOperator().then(function(){var c=b.isAuthorizedForCurrentPage();return c===!0?a.when():a.reject()}),e=c.getOrganizationSettings();return a.all([d,e])}]};a.when("/loading/:loadingMessage",{templateUrl:"js/common/controllers/loadingScreen.html",controller:"loadingScreenController",data:{authorizedRoles:[d.empty]}}),a.when("/home",{templateUrl:"js/common/controllers/homePage.html",controller:"homePageController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/login",{templateUrl:"js/account/controllers/login.html",controller:"loginController",data:{authorizedRoles:[d.empty]}}),a.when("/login/:action",{templateUrl:"js/account/controllers/login.html",controller:"loginController",data:{authorizedRoles:[d.empty]}}),a.when("/searchSubscribers",{templateUrl:"js/subscriber/controllers/searchSubscriberResults.html",controller:"searchSubscriberResultsController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/searchSubscriberResults/:searchText",{templateUrl:"js/subscriber/controllers/searchSubscriberResults.html",controller:"searchSubscriberResultsController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/settings",{templateUrl:"js/common/controllers/settings.html",controller:"settingsController",data:{authorizedRoles:[d.all]},resolve:k}),a.when("/messages",{templateUrl:"js/messages/controllers/messages.html",controller:"messagesController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/newMessage",{templateUrl:"js/messages/controllers/newMessage.html",controller:"newMessageController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/messages/:isToday/:index",{templateUrl:"js/messages/controllers/messagesDetail.html",controller:"messagesDetailController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/about",{templateUrl:"js/common/controllers/about.html",controller:"aboutController",data:{authorizedRoles:[d.all]},resolve:k}),a.when("/debugSettings",{templateUrl:"js/common/controllers/debugSettings.html",controller:"debugSettingsController",data:{authorizedRoles:[d.all]},resolve:k}),a.when("/listSelector/:title",{templateUrl:"js/common/controllers/listSelector.html",controller:"listSelectorController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/autoComplete/:index",{templateUrl:"js/common/controllers/autoComplete.html",controller:"autoCompleteController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/accountPages/requestResetPassword",{templateUrl:"js/account/controllers/requestResetPassword.html",controller:"requestResetPasswordController",data:{authorizedRoles:[d.empty]}}),a.when("/accountPages/resetPassword/:activationCode?",{templateUrl:"js/account/controllers/resetPassword.html",controller:"resetPasswordController",data:{authorizedRoles:[d.empty]}}),a.when("/accountPages/changePassword",{templateUrl:"js/account/controllers/changePassword.html",controller:"changePasswordController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/careRequest/:id",{templateUrl:"js/careRequests/controllers/careRequestDetail.html",controller:"careRequestDetailController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/careRequest/:id/update/:status",{templateUrl:"js/careRequests/controllers/careRequestUpdate.html",controller:"careRequestUpdateController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/firstStart/defineUrl",{templateUrl:"js/common/controllers/defineUrl.html",controller:"defineUrlController",data:{authorizedRoles:[d.empty]}}),a.when("/firstStart/defineLanguage",{templateUrl:"js/common/controllers/defineLanguage.html",controller:"defineLanguageController",data:{authorizedRoles:[d.empty]}}),a.when("/newSubscriber/profile",{templateUrl:"js/subscriber/controllers/newSubscriberProfile.html",controller:"newSubscriberProfileController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/newSubscriber/residence",{templateUrl:"js/subscriber/controllers/newSubscriberResidence.html",controller:"newSubscriberResidenceController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/profile",{templateUrl:"js/subscriber/controllers/subscriberPageProfile.html",controller:"subscriberPageProfileController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/care",{templateUrl:"js/subscriber/controllers/subscriberPageCare.html",controller:"subscriberPageCareController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/meds",{templateUrl:"js/subscriber/controllers/subscriberPageMeds.html",controller:"subscriberPageMedsController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/devices",{templateUrl:"js/subscriber/controllers/subscriberPageDevices.html",controller:"subscriberPageDevicesController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/alarms",{templateUrl:"js/subscriber/controllers/subscriberPageAlarms.html",controller:"subscriberPageAlarmsController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/map",{templateUrl:"js/subscriber/controllers/subscriberPageMap.html",controller:"subscriberPageMapController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/newNote",{templateUrl:"js/subscriber/controllers/newNote.html",controller:"newNoteController",data:{authorizedRoles:[d.empty]}}),a.when("/subscriberPage/:id/notes",{templateUrl:"js/subscriber/controllers/subscriberPageNotes.html",controller:"subscriberPageNotesController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/notes/:noteId",{templateUrl:"js/subscriber/controllers/subscriberPageNoteDetail.html",controller:"subscriberPageNoteDetailController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.when("/subscriberPage/:id/frame/:index",{templateUrl:"js/subscriber/controllers/subscriberPageFrame.html",controller:"subscriberPageFrameController",data:{authorizedRoles:[d.caregiver]},resolve:k}),a.otherwise({redirectTo:"/login"}),c.aHrefSanitizationWhitelist(/^\s*(https?|tel|file|ms-appx|x-wmapp0):/),e.addSetting({name:"LastUsedUsername"}),e.addSetting({name:"UserSettings",options:{needsParsing:!0}}),e.addSetting({name:"AppearanceSettings",options:{needsParsing:!0}}),f.setResourceFilesUrl("../../shared/localisation/"),f.setResourceFileNamePrefix("resources-locale_"),f.setDefaultLanguage("default"),j.setAlternativeServiceUrls(i.settings.alternativeUrls),g.supportModuleBasedAuthorization(!0),g.setApplicationSupportedModules([h.Responder])}]),angular.module("verklizan.umox.mobile").run(["$q","$rootScope","$timeout","splashScreenService","nativeNotificationService","localizedNotificationService","organizationSettingsService","settingsService","navigationService","pushNotificationSettingsService","GenericHttpErrorHandler","httpErrorCode","securityTokenService","localisationService","applicationLifeCycleService","userDataManager","urlSettingsService","languageSettingsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(b,c,d){var f,g,h=n.getLocalizedStringAsync(c).then(function(a){f=a}),i=n.getLocalizedStringAsync(d).then(function(a){g=a});a.all([h,i]).then(function(){e.alert(b,f,g)})}function t(){function a(){console.log("button is ok"),i.navigateAndReplace("/firstStart/defineUrl")}f.confirm("_Alerts_ServiceUnavailable_","_Alerts_ServiceUnavailableTitle_",["_Ok_","_Cancel_"]).ok(a)}function u(){f.alert("_Alerts_NoConnection_","_Alerts_NoConnectionTitle_","_Ok_")}function v(){m.removeToken(),p.setBackStackOfSessionAvailable(!0),i.navigate("/login/authError")}function w(a){return a.Message+" "+a.detail.ServerExceptionReferenceNumber}o.registerEvents(),(j.getIsPushEnabled()||j.getIsFaceTimeEnabled())&&j.initializePush();var x=b.$on("$viewContentLoaded",function(){c(d.turnOffSplashScreen,1e3),x()});b.$on("$locationChangeStart",function(a,c){q.hasValidBaseUrl()?r.getLanguage()?c.endsWith("/newSubscriber/profile")&&(g.getSubscriberStatus()||b.$evalAsync(function(){a.preventDefault(),f.alert("_NewSubscriberProfile_NoStatus_","_NewSubscriberProfile_NoStatusTitle_","_Ok_"),i.navigateAndReplace("/settings")})):b.$evalAsync(function(){a.preventDefault(),i.navigateAndReplace("/firstStart/defineLanguage")}):b.$evalAsync(function(){a.preventDefault(),i.navigateAndReplace("/firstStart/defineUrl")})}),b.$on("$routeChangeError",v),k.addErrorHandler(l.Unknown,u),k.addErrorHandler(l.NoConnection,u),k.addErrorHandler(l.BadRequest,function(a){var b=w(a.data);s(b,"_Alerts_BadRequestTitle_","_Ok_")}),k.addErrorHandler(l.InternalServerError,function(a){var b=a.headers["content-type"];if(!b||b.contains("application/xml"))f.alert("_Alerts_ServerError_","_Alerts_ServerError_Title_","_Ok_");else if(b.contains("application/json")){var c=w(a.data);s(c,"_Alerts_BusinessException_","_Ok_")}}),k.addErrorHandler(l.NotFound,t),k.addErrorHandler(l.ServiceUnavailable,t),k.addErrorHandler(l.NotAuthorized,v),k.addErrorHandler(l.Forbidden,v)}]),angular.module("verklizan.umox.mobile.careRequests").constant("careRequestTypes",{autoAssist:"AutoAssist",manual:"Manual"}),angular.module("verklizan.umox.mobile.careRequests").controller("careRequestDetailController",["$scope","$routeParams","domainModel","careRequestDataManager","uiMapHelperService","navigationService","launchNavigatorService","localizedNotificationService","deviceService","devicePlatformConstants","promiseLoadingSpinnerService","careRequestTypes","organizationSettingsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";a.careRequestId=b.id,a.careRequest=null,a.mapErrorMessage=null,a.emptyDateFormat="**.**.**",a.careRequestStatus=c.careRequestStatus,a.navigationDestination="",a.isLoading=k.getIsLoading,a.careRequestTypes=l,a.allowAddNotesInResponder=m.getAllowAddNotesInResponder(),a.allowActionArrived=null,a.allowActionDone=null,a.allowActionDoneIfNotYetArrived=null,a.$on("$viewContentLoaded",function(){n()}),a.setCareRequestStatus=function(b){if(b===a.careRequestStatus.Accept&&a.careRequest.Type===l.autoAssist){var c=d.updateCareRequestWithNewStatus(a.careRequestId,b,null).then(n);k.addLoadingPromise(c)}else f.navigate("/careRequest/"+a.careRequestId+"/update/"+b)},a.setCareRequestToCall=function(){var b=d.acceptAutoAssistWithSpeak(a.careRequestId);b.then(n),k.addLoadingPromise(b)},a.declineSpeechRequest=function(){var b=d.declineSpeechRequest(a.careRequestId);b.then(n),k.addLoadingPromise(b)},a.canShowMaps=function(){if(a.careRequest){var b=a.careRequest.Status;return b===c.careRequestStatus.Send||b===c.careRequestStatus.RequestReceived||b===c.careRequestStatus.Accept}},a.canShowStatusTime=function(){if(a.careRequest){var b=a.careRequest.Status;return b!==c.careRequestStatus.Send&&b!==c.careRequestStatus.RequestReceived&&b!==c.careRequestStatus.Accept}},a.navigateToSubscriberDetail=function(){f.navigate("/subscriberPage/"+a.careRequest.SubscriberId+"/profile")},a.openNavigation=function(a){a&&g.navigate(a).catch(w)},a.createNewNote=function(a){f.navigate("/subscriberPage/"+a+"/newNote")},a.canAcceptWithSpeech=function(){if(a.careRequest){var b=!q(),c=a.careRequest.IsWithSpeech;return b&&c}},a.canAcceptWithoutSpeech=function(){if(a.careRequest){var b=a.careRequest.Status===a.careRequestStatus.Send||a.careRequest.Status===a.careRequestStatus.RequestReceived,c=a.canAcceptWithSpeech();return b&&!c}},a.canClickDeclineCall=function(){if(a.careRequest){var b=a.canAcceptWithSpeech(),c=r(a.careRequest);return b&&!c}},a.canClickDone=function(){if(a.careRequest){if(!a.allowActionDone)return!1;var b=a.careRequest.Status===c.careRequestStatus.Arrived,d=a.careRequest.Status===c.careRequestStatus.Accept;return!!b||!(!d||!a.allowActionDoneIfNotYetArrived)}};var n=function(){p(a.careRequestId).then(function(b){a.canShowMaps()&&e.initializeMap(a.myMap,b.Adress).catch(v),s(a.careRequestId),o()}),u()},o=function(){q()?(a.allowActionArrived=m.getAllowActionArrived(),a.allowActionDone=m.getAllowActionDone()):(a.allowActionArrived=!0,a.allowActionDone=!0),a.allowActionDoneIfNotYetArrived=m.getAllowActionDoneIfNotYetArrived()},p=function(b){var c=d.getCareRequestBySessionId(b).then(function(b){return a.careRequest=b,b});return k.addLoadingPromise(c),c},q=function(){return a.careRequest.Type!==l.autoAssist},r=function(b){return b.Status===a.careRequestStatus.Send||b.Status===a.careRequestStatus.RequestReceived},s=function(b){a.careRequest.Status===c.careRequestStatus.Send&&t(b,c.careRequestStatus.RequestReceived)},t=function(a,b){var c=d.updateCareRequestWithNewStatus(a,b).then(function(){p(a)});k.addLoadingPromise(c)},u=function(){var b=i.platform;b===j.Android?a.navigationDestination="Google Maps":b===j.iOS&&(a.navigationDestination="Apple Maps")},v=function(b){a.mapErrorMessage=b.localizedErrorMessage},w=function(){h.alert("_Alerts_NavigateError_","_Alerts_NavigateError_Title_","_Ok_")}}]),angular.module("verklizan.umox.mobile.careRequests").controller("careRequestUpdateController",["$scope","$routeParams","domainModel","careRequestDataManager","navigationService","fieldLengthConstants","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g){"use strict";a.remarkCharacterCountLimit=f.careRequestRemark,a.careRequestId=b.id,a.newStatus=parseInt(b.status),a.statusUpdateRemark="",a.sendStatusUpdate=function(){if(!a.remarkIsToLong()){var b=d.updateCareRequestWithNewStatus(a.careRequestId,a.newStatus,a.statusUpdateRemark).then(h);g.addLoadingPromise(b)}},a.remarkIsToLong=function(){return a.remarkCharactersStillAvailable()<0},a.remarkPercentageCharactersAvailable=function(){return 100*a.remarkCharactersStillAvailable()/a.statusUpdateRemark.length},a.remarkCharactersStillAvailable=function(){return a.remarkCharacterCountLimit-a.statusUpdateRemark.length};var h=function(){i(a.newStatus)?e.goBackMultiplePages(2):e.goBack()},i=function(a){return a===c.careRequestStatus.Decline||a===c.careRequestStatus.Done}}]),angular.module("verklizan.umox.mobile.careRequests").directive("careRequestListItem",["navigationService",function(a){"use strict";return{restrict:"E",scope:{careRequestItem:"=prCareRequestItem",navigationFromListItemEnabled:"=prNavigationFromListItemEnabled",limitReason:"=prCareRequestLimitedReason",showSpeechIcon:"=prShowSpeechIcon"},templateUrl:"js/careRequests/directives/careRequestListItem.html",link:function(b){b.navigateToSubscriberDetail=function(){b.navigationFromListItemEnabled===!0&&a.navigate("/subscriberPage/"+b.careRequestItem.SubscriberId+"/profile")}}}}]),angular.module("verklizan.umox.mobile.subscriber").filter("careRequestStatusToText",["domainModel",function(a){return function(b){switch(b){case a.careRequestStatus.Send:case a.careRequestStatus.RequestReceived:return"_CareRequestStatus_Alarm_";case a.careRequestStatus.Accept:return"_CareRequestStatus_Accept";case a.careRequestStatus.Decline:return"_CareRequestStatus_Decline";case a.careRequestStatus.Arrived:return"_CareRequestStatus_Arrived";case a.careRequestStatus.Done:return"_CareRequestStatus_Done";case a.careRequestStatus.Closed:return"_CareRequestStatus_Closed_";case a.careRequestStatus.Cancelled:return"_CareRequestStatus_Cancelled_";case a.careRequestStatus.DeviceNotReachable:return"_CareRequestStatus_DeviceNotReachable";case a.careRequestStatus.Unknown:default:return"_CareRequestStatus_Unknown_"}}}]),angular.module("verklizan.umox.mobile.common").service("careRequestAutoResponseService",["$q","$timeout","userSettingsService","careRequestDataManager","domainEnums",function(a,b,c,d,e){"use strict";this.handleAutomaticResponse=function(a){var d=c.getAutoCareRequestInterval();return b(f,d,!0,a)};var f=function(b){var c=[];console.log("starting sending automatic responses");for(var f=0;f<b.length;f++){var h=b[f],i=g(h.Status);if(console.log("next status will be "+i),i!==e.careRequestStatus.Unknown){var j=d.updateCareRequestWithNewStatus(h.SessionId,i,"Automatic update by Responder App");c.push(j)}}return a.all(c)},g=function(a){switch(a){case e.careRequestStatus.Send:case e.careRequestStatus.RequestReceived:return e.careRequestStatus.Accept;case e.careRequestStatus.Accept:return e.careRequestStatus.Arrived;case e.careRequestStatus.Arrived:return e.careRequestStatus.Done;default:return e.careRequestStatus.Unknown}}}]),angular.module("verklizan.umox.mobile.careRequests").service("careRequestDataManager",["$q","config","webRequestService","pushNotificationServiceRequestModel","pushNotificationSettingsService","pushNotificationServiceProxy","GenericHttpErrorHandler","descriptorFactory","domainEnums","descriptors","organizationSettingsService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";this.getCareRequestsOfToday=function(){if(b.testData&&b.testData.overrideCareRequests)return a.when([b.testData.manualCareRequest]);var c=e.getPushTelNumber();if(!c)return a.reject();var d=[];d.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Done.toString(),i.filterOperation.Not)),d.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Decline.toString(),i.filterOperation.Not)),d.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Cancelled.toString(),i.filterOperation.Not)),d.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Closed.toString(),i.filterOperation.Not));var g=new j.filterDescriptor(d,i.filterOperator.And),k=h.readLargeData(0,d),l=new j.sortDescriptor(!1,"AlarmFiredTime");return f.readCareRequestPage(c,g,l,k.pageDescriptor).then(m)},this.getPreviousCareRequests=function(){var b=e.getPushTelNumber();if(!b)return a.reject();var c=[];c.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Done.toString(),i.filterOperation.Equals)),c.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Decline.toString(),i.filterOperation.Equals)),c.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Cancelled.toString(),i.filterOperation.Equals)),c.push(new j.filterDescriptorItem("Status",i.careRequestStatus.Closed.toString(),i.filterOperation.Equals));var d=new j.filterDescriptor(c,i.filterOperator.Or),g=[];g.push(new j.filterDescriptorItem("AlarmFiredTime",l(),i.filterOperation.Greater));var k=new j.filterDescriptor(g,i.filterOperator.And),n=new j.filterDescriptor([d,k],i.filterOperator.And),o=h.readLargeData(0),p=new j.sortDescriptor(!1,"AlarmFiredTime");return f.readCareRequestPage(b,n,p,o.pageDescriptor).then(m)},this.updateCareRequestWithNewStatus=function(a,b,c){var d=e.getPushTelNumber(),g={SessionId:a,Status:b,PhoneNumber:d,Remark:c};return f.updateCareRequestStatus(g)},this.acceptAutoAssistWithSpeak=function(a){return f.acceptCareRequestWithSpeak(a)},this.declineSpeechRequest=function(a){return f.declineSpeechRequest(a)},this.getCareRequestBySessionId=function(c){return c?b.testData&&c===b.testData.manualCareRequest.SessionId?a.when(b.testData.manualCareRequest):f.getCareRequest(c):a.reject("must provide a session id")};var l=function(){var a=k.getCareRequestHistoryLengthDaysInResponder(),b=new Date((new Date).setDate((new Date).getDate()-a));return b},m=function(a){var b=a.CareRequests;return b}}]),angular.module("verklizan.umox.mobile.careRequests").factory("pushNotificationServiceRequestModel",["pageSize","domainModel",function(a,b){"use strict";var c={};c.updateCareRequestStatus=function(a,b,c,d){return{requestMessage:{SessionId:a,Status:b,PhoneNumber:c,Remark:d}}},c.acceptCareRequestWithSpeak=function(a){return{sessionId:a}},c.readCareRequestPage=function(c){var e=[];e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Done.toString(),b.filterOperation.Not)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Decline.toString(),b.filterOperation.Not)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Cancelled.toString(),b.filterOperation.Not)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Closed.toString(),b.filterOperation.Not));var f=new b.filterDescriptor(e,b.filterOperator.And);return d(c,f,a.Large)},c.readCareRequestPageHistory=function(c){var e=[];e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Done.toString(),b.filterOperation.Equals)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Decline.toString(),b.filterOperation.Equals)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Cancelled.toString(),b.filterOperation.Equals)),e.push(new b.filterDescriptorItem("Status",b.careRequestStatus.Closed.toString(),b.filterOperation.Equals));var f=new b.filterDescriptor(e,b.filterOperator.Or);return d(c,f,a.Large)};var d=function(a,c,d){return{phoneNumber:a,pageDescriptor:new b.pageDescriptor(0,d),filters:c,sort:null}};return c.getCareRequest=function(a){return{sessionId:a}},c.registerDevice=function(a,b,c,d){return{device:{PhoneNumber:a,Token:b,Type:c},subscriptionType:d}},c.unregisterDevice=function(a,b){return{phoneNumber:a,subscriptionType:b}},c}]),angular.module("verklizan.umox.mobile.common").service("pushNotificationSettingsService",["$rootScope","$q","$routeParams","$window","$timeout","userSettingsService","config","cordovaDeviceToPushDeviceFilter","pushNotificationService","webRequestService","pushNotificationServiceRequestModel","deviceService","securityTokenService","navigationService","localizedNotificationService","GenericHttpErrorHandler","pushNotificationServiceProxy","httpErrorCode","domainModel","nativeNotificationService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";var u=this,v=(p.createWithAllErrorCodesEnabledExcept(r.NoConnection),!1),w=!1,x=8e3,y=new Date;a.$on("login",function(){console.log("push settings reacts to login"),u.getIsPushEnabled()&&u.setIsPushEnabled(!0),u.getIsFaceTimeEnabled()&&u.setIsFaceTimeEnabled(!0)}),this.initializePush=function(){console.log("initializes push"),E(),i.registerPushEvents(),v=!0},this.getPushTelNumber=function(){return f.getPushTelNumber()},this.setPushTelNumber=function(a){f.setPushTelNumber(a)},this.getIsPushEnabled=function(){var a=f.getPushIsEnabled();return"undefined"!=typeof a&&null!==a&&a},this.setIsPushEnabled=function(a){f.setPushIsEnabled(a);var b=u.getPushTelNumber();return a===!0?A(b,s.pushSubscriptionType.CareRequests).catch(H):a===!1?C(b,s.pushSubscriptionType.CareRequests):void 0},this.getFaceTimeId=function(){return f.getFaceTimeId()},this.setFaceTimeId=function(a){f.setFaceTimeId(a)},this.getIsFaceTimeEnabled=function(){var a=f.getIsFaceTimeEnabled();return"undefined"!=typeof a&&null!==a&&a},this.setIsFaceTimeEnabled=function(a){f.setIsFaceTimeEnabled(a);var b=u.getFaceTimeId();return a===!0?A(b,s.pushSubscriptionType.FaceTime).catch(I):a===!1?C(b,s.pushSubscriptionType.FaceTime):void 0;
};var z=function(){console.log("initialize push if necessary: "+v),v===!1&&u.initializePush()},A=function(a,b){return console.log("about to register device"),B().then(function(c){return console.log("Token received is "+c),D(a,c,b)}).then(z)},B=function(){return i.registerPushEventAndReturnToken().catch(function(a){return g.testData.pushToken?g.testData.pushToken:b.reject(a)})},C=function(a,b){return q.unregisterDevice(a,b)},D=function(a,b,c){var d=G(),e={PhoneNumber:a,Token:b,Type:d};return q.registerDevice(e,c)},E=function(){console.log("adds event listener for push"),i.addEventListenerForPush(F)},F=function(a,b){switch(console.log("custom content to callback "+b),b.pushNotificationType){case"CareRequest":K(b,a);break;case"FaceTime":J(b,a)}},G=function(){var a=l.platform;return h(a)},H=function(a){return f.setPushIsEnabled(!1),b.reject(a)},I=function(a){return f.setIsFaceTimeEnabled(!1),b.reject(a)},J=function(a,b){console.log("handling facetime: "+a+" "+a.faceTimeId),d.open("facetime://"+a.faceTimeId,"_system")},K=function(a,b){w=!0;var c="True"===a.isPing||!1;b===!0&&c===!0&&y<new Date?(t.beep(2),y=new Date((new Date).getTime()+x)):b===!0&&L()&&c===!1?(t.beep(2),n.reloadCurrentPage()):m.isTokenExpired()&&n.navigateAndReplace("/login/careRequestReceived")},L=function(){return"/home"===n.getCurrentPage()&&"careHistory"!==c.state||n.getCurrentPage().includes("/careRequest/")};this.getCareRequestReceived=function(){return w}}]),angular.module("verklizan.umox.mobile.common").constant("fieldLengthConstants",{noteTitle:257,careRequestRemark:80}),angular.module("verklizan.umox.mobile.common").constant("generalConstants",{defaultServiceRequestTimeoutInSeconds:20}),angular.module("verklizan.umox.mobile.common").constant("urlConstants",{loginService:["login","logout","readCurrentUserInfo"],settingsService:["getResponderSettings"],userManagementService:["readCurrentOperator","requestPasswordReset","resetPassword","changePassword"],subscriberManagementService:["searchSubscribers","readsubscriber","createsubscriber","readsubscriberstatepage","readmedicalinfopage","readmedicationpage","createsubscribernote","readSubscriberHtmlNote","readSubscriberHtmlNotePage","readSubscriberNotePage"],residenceManagementService:["readresidence","createresidence"],careProviderManagementService:["readCaregiversForSubscriberResidenceSchemePage","readCurrentProfessionalCaregiver","readProfessionalCaregiverContactItemPage"],deviceManagementService:["readdevicesforsubscriberresidencepage","searchdevice","readdevicestatepage"],incidentManagementService:["readincidentpageforsubscriber"],supportingDataManagementService:["readOrganizationPage","readNewOrganizationMessageCount","readcitypage","readregionpage","createorganizationnote","readorganizationnotepage","readContractVersion"],contractManagementService:["createsubscriberdevicelink","deletesubscriberdevicelink","createresidencedevicelink","deleteresidencedevicelink"],pushNotificationService:["registerDevice","unregisterDevice","readCareRequestPage","updateCareRequestStatus","acceptCareRequestWithSpeak","getCareRequest"]}),angular.module("verklizan.umox.mobile.common").controller("aboutController",["$scope","$timeout","config","userSettingsService","verklizanConfig","navigationService",function(a,b,c,d,e,f){"use strict";function g(){b(function(){a.appLogoClickedCount=0},h)}var h=5e3;a.appIsDebugBuild=c.debug===!0,a.isInDebugMode=d.getIsInDebugMode(),a.appVersion=c.version,a.serviceVersion=e.serviceVersionSupported,a.appLogoClickedCount=0,a.clickedAppLogo=function(){0===a.appLogoClickedCount&&g(),a.appLogoClickedCount++,a.appLogoClickedCount>=5&&(d.setIsInDebugMode(!0),a.isInDebugMode=!0)},a.navigateToDebugPage=function(){f.navigate("/debugSettings")}}]),angular.module("verklizan.umox.mobile.common").controller("autoCompleteController",["$scope","$routeParams","promiseLoadingSpinnerService","navigationService","autoCompleteService",function(a,b,c,d,e){"use strict";var f,g=10,h=500,i=3,j=null;(!b.index||b.index<0)&&d.goBack(),a.autoCompleterObject=e.getAutoCompleter(b.index),a.title=a.autoCompleterObject.title,a.filterText="",a.pageLimit=g,a.searchCharactersRequired=i,a.$on("$viewContentLoaded",function(){return window.isNullOrUndefined(a.autoCompleterObject)?void d.goBack():void l("")}),a.$watch("filterText",function(){a.search()}),a.selectItem=function(b){a.autoCompleterObject.selectItem(b)},a.search=function(){a.show3CharactersRequired=!1,a.filterText||(a.filterText="");var b=angular.lowercase(a.filterText).trim();if(a.searchValue!==b)return a.searchValue=b,0!==a.searchValue.length&&a.searchValue.length<3?(a.show3CharactersRequired=!0,a.loading=!1,j=null,a.items=[],void(a.totalCount=0)):void l()},a.showMore=function(){var b=a.searchValue;if(a.pageIndex*g<a.totalCount){if(j===a.pageIndex)return;a.loading=!0;var d=a.autoCompleterObject.dataManager.searchPage(a.searchValue,a.autoCompleterObject.params,a.pageIndex+1).then(function(c){if(b===a.searchValue){for(var d in c.Rows)a.items.push(c.Rows[d]);a.loading=!1,j=a.pageIndex,a.pageIndex++}});c.addLoadingPromise(d)}};var k=function(a,b){return window.isNullOrUndefined(b)===!1&&clearTimeout(b),setTimeout(a,h)},l=function(){a.loading=!0;var b=function(b){return function(){a.pageIndex=0;var d=a.autoCompleterObject.dataManager.searchPage(b,a.autoCompleterObject.params,a.pageIndex).then(function(c){b===a.searchValue&&(a.items=c.Rows,a.totalCount=c.TotalCount,j=null),a.loading=!1}).catch(function(b){a.loading=!1,j=null,a.items=[]});c.addLoadingPromise(d)}};f=k(b(a.searchValue),f)}}]),angular.module("verklizan.umox.mobile.common").controller("debugSettingsController",["$scope","$timeout","config","userSettingsService",function(a,b,c,d){"use strict";a.isInDebugMode=d.getIsInDebugMode(),a.autoCareRequestEnabled=d.getAutoCareRequestEnabled(),a.autoCareRequestInterval=d.getAutoCareRequestInterval(),a.processToggleDebugMode=function(a){d.setIsInDebugMode(a)},a.processToggleAutoCareRequest=function(a){d.setAutoCareRequestEnabled(a)},a.setAutoCareRequestInterval=function(){a.autoCareIntervalForm.$valid&&d.setAutoCareRequestInterval(a.autoCareRequestInterval)}}]),angular.module("verklizan.umox.mobile.common").controller("defineLanguageController",["$scope","languageSettingsService","navigationService",function(a,b,c){"use strict";a.langError=!1,a.next=function(){b.getLanguage()?c.navigateAndReplace("/login"):a.langError=!0}}]),angular.module("verklizan.umox.mobile.common").controller("defineUrlController",["$scope","navigationService","urlSettingsService",function(a,b,c){"use strict";a.baseUrl=c.getBaseUrlObject(),a.isSubmitted=!1,a.next=function(){a.urlForm.$valid?(c.setBaseUrlObject(a.baseUrl.host,a.baseUrl.port,a.baseUrl.path),b.navigateAndReplace("/login")):a.isSubmitted=!0}}]),angular.module("verklizan.umox.mobile.common").controller("homePageController",["$scope","messageDataManager","navigationService","pushNotificationSettingsService","organizationSettingsService",function(a,b,c,d,e){"use strict";a.pushIsEnabled=d.getIsPushEnabled(),a.newMessageCount=0,a.settings={allowAddSubscriberInResponder:e.getAllowAddSubscriberInResponder(),allowSearchSubscriberInResponder:e.getAllowSearchSubscriberInResponder(),saveUsernameAfterLoginInResponder:e.getSaveUsernameAfterLoginInResponder()},a.$on("$viewContentLoaded",function(){f()}),a.navigate=function(a){console.log("Navigate: "+a),c.navigate(a)};var f=function(){b.getNewMessageCount().then(function(b){a.newMessageCount=b})}}]),angular.module("verklizan.umox.mobile.common").controller("listSelectorController",["$scope","$routeParams","listSelectorService","promiseLoadingSpinnerService","navigationService",function(a,b,c,d,e){"use strict";var f=10;a.title=b.title,a.filterText="",a.selectorOptions=c.getControllerData(),a.pageLimit=f,a.$on("$viewContentLoaded",function(){if("undefined"==typeof a.selectorOptions)return void e.goBack();var b=a.selectorOptions.dataSetPromise.then(function(b){a.selectorOptions.dataSet=b});d.addLoadingPromise(b)}),a.increasePageLimit=function(){a.pageLimit=a.pageLimit+f},a.selectItem=function(a){c.selectItem(a)}}]),angular.module("verklizan.umox.mobile.common").controller("loadingScreenController",["$routeParams","$scope",function(a,b){"use strict";b.loadingMessage=a.loadingMessage}]),angular.module("verklizan.umox.mobile.common").controller("settingsController",["$scope","$q","settingsService","pushNotificationSettingsService","USER_ROLES","supportingDataManager","userDataManager","localizedNotificationService","navigationService","loginServiceWrapper","organizationSettingsService","devicePlatformConstants","deviceService","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";a.currentUserRole=g.getCurrentUserRole(),a.roles=e,a.isLoading=n.getIsLoading,a.subscriberStatussesPromise=null,a.deviceStatussesPromise=null,a.statusses=null,a.newDeviceStatusses=null,a.userOrganizationId=g.getUserOrganizationId(),a.settings={status:k.getSubscriberStatus(),newDeviceStatus:k.getNewDeviceStatus(),deviceUnlinkStatus:k.getUnlinkDeviceStatus()},a.newSubscriberStatusIsEditable=!k.isSubscriberStatusOrganizationSetting(),a.newDeviceStatusIsEditable=!k.isNewDeviceStatusOrganizationSetting(),a.deviceUnlinkStatusIsEditable=!k.isUnlinkDeviceStatusOrganizationSetting(),a.pushEnableError=!1,a.caregiverPhoneNumbers=[],a.pushSettings={pushEnabled:d.getIsPushEnabled(),pushTelNumber:d.getPushTelNumber()},a.faceTimeError=!1,a.faceTimeSettings={faceTimeEnabled:d.getIsFaceTimeEnabled(),faceTimeId:d.getFaceTimeId()},a.caregiverNumbersPromise=null,a.$on("$viewContentLoaded",function(){a.currentUserRole===a.roles.caregiver&&(a.caregiverNumbersPromise=g.getCurrentCaregiverPhoneNumbers(),a.caregiverNumbersPromise.then(o)),a.subscriberStatussesPromise=f.getSubscriberStates().then(B),a.deviceStatussesPromise=f.getNewDeviceStatusses().then(C)}),a.setStatus=function(){k.setSubscriberStatus(a.settings.status)},a.setDeviceStatus=function(){k.setNewDeviceStatus(a.settings.newDeviceStatus)},a.setDeviceUnlinkStatus=function(){k.setUnlinkDeviceStatus(a.settings.deviceUnlinkStatus)},a.setPushTelNumber=function(b){d.setPushTelNumber(b),a.pushEnableError=!1},a.processPushEnabled=function(a){a===!0?p(a):a===!1&&r(a)},a.setFaceTimeId=function(a){d.setFaceTimeId(a)},a.processFaceTimeEnabled=function(a){a===!0?q(a):a===!1&&q(a)},a.navigateToChangePassword=function(){i.navigate("/accountPages/changePassword")},a.logout=function(){j.logout().then(function(){i.navigate("/login")})},a.platformIsValidForFacetime=function(){if(m.platform===l.iOS){var a=m.version,b=a.split("."),c=parseInt(b[0]),d=parseInt(b[1]);if(c>8||8===c&&d>=3)return!0}return!1};var o=function(b){a.caregiverPhoneNumbers=b.Rows},p=function(b){v()?(t(b),a.pushEnableError=!1):(a.pushEnableError=!0,a.pushSettings.pushEnabled=!1)},q=function(b){w()?(u(b),a.faceTimeError=!1):(a.faceTimeError=!0,a.faceTimeSettings.faceTimeEnabled=!1)},r=function(){var a=d.getPushTelNumber();a&&h.confirm("_Settings_DisablePushConfirmation_Message_","_Settings_DisablePushConfirmation_Title_",["_Ok_","_Cancel_"]).ok(s).finally(x)},s=function(){t(a.pushSettings.pushEnabled)},t=function(a){var b=d.setIsPushEnabled(a).then(z).catch(A).finally(function(){x()});n.addLoadingPromise(b)},u=function(a){var b=d.setIsFaceTimeEnabled(a).catch(A).finally(function(){y()});n.addLoadingPromise(b)},v=function(){return!!a.pushSettings.pushTelNumber},w=function(){return!!a.faceTimeSettings.faceTimeId},x=function(){a.pushSettings.pushEnabled=d.getIsPushEnabled()},y=function(){a.faceTimeSettings.faceTimeEnabled=d.getIsFaceTimeEnabled()},z=function(){a.pushSettings.pushEnabled===!0?h.alert("_Alerts_DeviceRegistered_","_Alerts_DeviceRegistered_Title_","_Ok_"):h.alert("_Alerts_DeviceUnregistered_","_Alerts_DeviceUnregistered_Title_","_Ok_")},A=function(a){console.log("Register for push failed: "+a),h.alert("_Alerts_DeviceCannotBeRegistered_","_Alerts_DeviceCannotBeRegistered_Title_","_Ok_")},B=function(b){a.statusses=b},C=function(b){a.newDeviceStatusses=b}}]),angular.module("verklizan.umox.mobile.common").directive("boolGlyphicon",function(){"use strict";return{restrict:"E",scope:{isOkGlypicon:"=bool"},templateUrl:"js/common/directives/boolGlyphicon.html"}}),angular.module("verklizan.umox.mobile.common").directive("diAboutbutton",["navigationService",function(a){"use strict";return{restrict:"A",templateUrl:"js/common/directives/buttons/aboutbutton.html",link:function(b,c,d){b.goAbout=function(){a.navigate("/about"),console.log("About button directive triggered")}}}}]),angular.module("verklizan.umox.mobile.common").directive("diBackbutton",["navigationService",function(a){"use strict";return{restrict:"A",templateUrl:"js/common/directives/buttons/backbutton.html",link:function(b,c,d){b.goBack=function(){a.goBack(),console.log("Back button directive triggered")}}}}]),angular.module("verklizan.umox.mobile.common").directive("diHomebutton",["navigationService",function(a){"use strict";return{restrict:"A",templateUrl:"js/common/directives/buttons/homebutton.html",link:function(b,c,d){b.goHome=function(){a.goHome(),console.log("Home button directive triggered")}}}}]),angular.module("verklizan.umox.mobile.common").directive("diCapitalizeFirst",function(){"use strict";return{require:"ngModel",link:function(a,b,c,d){if(navigator.userAgent.match(/(Android)/)){var e=function(a){if(a){var b=a.charAt(0).toUpperCase()+a.substring(1);return b!==a&&(d.$setViewValue(b),d.$render()),b}};d.$parsers.push(e),e(a[c.ngModel])}}}}),angular.module("verklizan.umox.mobile.common").directive("diDatepicker",["deviceService","devicePlatformConstants",function(a,b){"use strict";return{restrict:"E",scope:{prBinding:"=",prShowTime:"=",prStartYearDelta:"@",prEndYearDelta:"@",prDefaultYearDelta:"@"},templateUrl:"js/common/directives/datePicker.html",link:function(c,d,e){function f(){var a=g();c.prShowTime===!0?l.mobiscroll().datetime(a):l.mobiscroll().date(a),c.prBinding&&l.mobiscroll("setDate",c.prBinding,!0)}function g(){var a={theme:h(),display:"modal",mode:"scroller",dateOrder:"ddMyy",startYear:i(),endYear:j(),defaultValue:k(),onSelect:function(a,b){c.$apply(function(){var a=l.mobiscroll("getDate");c.prBinding=a})}};return a}function h(){switch(a.platform){case b.iOS:return"ios7";case b.Android:return"android-holo light";case b.WP8:case b.WP7:return"wp light";default:return"android-holo light"}}function i(){var a=new Date,b=0|parseInt(c.prStartYearDelta);return a.getFullYear()+b}function j(){var a=new Date,b=0|parseInt(c.prEndYearDelta);return a.getFullYear()+b}function k(){var a=new Date;if(c.prDefaultYearDelta){var b=0|parseInt(c.prDefaultYearDelta),d=a.getFullYear()+b;a=new Date(d,0,1)}return a}var l=d.find("input");c.prShowTime=!!angular.isDefined(c.prShowTime)&&c.prShowTime,c.showDate=function(){l.mobiscroll("show")},c.resetDate=function(){l.val(""),c.prBinding=""},f()}}}]),angular.module("verklizan.umox.mobile.common").directive("diHeaderBanner",function(){"use strict";return{restrict:"A",scope:{prHeaderFirstLine:"=",prHeaderFirstLineLocalized:"@",prHeaderSecondLine:"=",prHeaderSecondLineLocalized:"@",prBack:"=",prHome:"=",prAbout:"="},templateUrl:"js/common/directives/headerBanner.html",link:function(a){}}}),angular.module("verklizan.umox.mobile.common").directive("diCareRequests",["$location","navigationService","careRequestDataManager","promiseLoadingSpinnerService","organizationSettingsService","userSettingsService","careRequestAutoResponseService",function(a,b,c,d,e,f,g){"use strict";return{restrict:"E",templateUrl:"js/common/directives/homePage/careRequests.html",scope:{},link:function(h,i,j){function k(){var a=c.getCareRequestsOfToday().then(function(a){h.currentCareRequests=a,l(a)&&(console.log("Automatic response is enabled and will be handled"),g.handleAutomaticResponse(a).then(k))});d.addLoadingPromise(a)}function l(a){var b=a.length>0,c=f.getAutoCareRequestEnabled()&&f.getIsInDebugMode();return b&&c}function m(){var a=c.getPreviousCareRequests().then(function(a){h.previousCareRequests=a});d.addLoadingPromise(a)}h.currentCareRequests=null,h.previousCareRequests=null,h.state=a.search(),h.showOnlyToday="careHistory"!==a.search().state,h.careRequestHistoryLengthDaysInResponder=e.getCareRequestHistoryLengthDaysInResponder(),function(){h.showOnlyToday?k():m()}(),h.showTodaysCareRequests=function(){a.search("state",null)},h.showPreviousCareRequests=function(){a.search("state","careHistory")},h.toCareRequestDetail=function(a){b.navigate("careRequest/"+a)}}}}]),angular.module("verklizan.umox.mobile.common").directive("diTodaysMessages",["$timeout","navigationService","messageDataManager","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";return{restrict:"E",templateUrl:"js/common/directives/homePage/todaysMessages.html",scope:{},link:function(f){console.log("messages today directive loaded"),f.messagesViewModel=new d(d.pageSizes.Normal),a(function(){f.loadMoreMessages()},0),f.loadMoreMessages=function(){var a=c.loadMessages(!0,f.messagesViewModel.nextPageNumber).then(function(a){f.messagesViewModel.addData(a)}).catch(function(a){console.error(a)});e.addLoadingPromise(a)},f.toDetailMessage=function(a){b.navigate("messages/1/"+a)}}}}]),angular.module("verklizan.umox.mobile.common").directive("diInputSpinnerFullsize",["$q",function(a){"use strict";return{restrict:"A",scope:{isLoadedPromise:"=prIsLoadingPromise"},transclude:!0,templateUrl:"js/common/directives/inputSpinner.html",link:function(b){b.isSmallSpinnerLoading=!0,a.when(b.isLoadedPromise).finally(function(){b.isSmallSpinnerLoading=!1})}}}]),angular.module("verklizan.umox.mobile.common").directive("diKeyboardHelper",function(){"use strict";return{restrict:"A",templateUrl:"js/common/directives/keyboardHelper/keyboardHelper.html",link:function(a,b,c){}}}),angular.module("verklizan.umox.mobile.common").directive("diKeyboardHelperTarget",function(){"use strict";return{restrict:"A",link:function(a,b,c){navigator.userAgent.match(/(Android)/)&&(b.bind("focus",function(){a.$apply(function(){console.log("focus"),a.inputFocus=!0})}),b.bind("blur",function(){a.$apply(function(){console.log("blur"),a.inputFocus=!1})}))}}}),angular.module("verklizan.umox.mobile.common").directive("diLoadingSpinnerFromService",["$q","promiseLoadingSpinnerService",function(a,b){"use strict";return{restrict:"E",transclude:!0,template:'<div class="spinner" ng-show="loadingSpinnerIsShown"></div>',link:function(a){function c(b){a.loadingSpinnerIsShown=b}a.loadingSpinnerIsShown=!1,b.registerForLoadingUpdate(c)}}}]),angular.module("verklizan.umox.mobile.common").directive("diNoteFooter",["$routeParams","navigationService","organizationSettingsService","subscriberDataManager",function(a,b,c,d){"use strict";return{restrict:"E",templateUrl:"js/common/directives/noteFooter.html",link:function(e,f,g){e.newNote=function(){d.newNoteCache=null;var a=h();b.navigate(a)},e.allowAddNotesInResponder=function(){var a=c.getAllowAddNotesInResponder();return a};var h=function(){var b=a.id,c="/subscriberPage/"+b+"/newNote";return c}}}}]),angular.module("verklizan.umox.mobile.common").directive("diSetLanguage",["languageSettingsService","supportingDataManager","localisationService","navigationService",function(a,b,c,d){"use strict";return{restrict:"A",templateUrl:"js/common/directives/setLanguage.html",link:function(e,f,g){e.language=a.getLanguage(),e.languages=b.getLanguages(),e.setLanguage=function(){a.setLanguage(e.language),c.initNewLanguage(),d.reloadCurrentPage()}}}}]),angular.module("verklizan.umox.mobile.common").directive("diToggleSwitch",["$timeout",function(a){"use strict";return{restrict:"E",scope:{toggleSwitchId:"@prToggleSwitchId",switchModel:"=ngModel",ngChange:"&",switchDisabled:"=ngDisabled"},templateUrl:"js/common/directives/toggleSwitch.html",link:function(b){b.modelChanged=function(c){"function"==typeof b.ngChange()&&a(function(){b.ngChange()(c)},0)}}}}]),angular.module("verklizan.umox.mobile.common").service("applicationLifeCycleService",["$timeout","$window","$location","$rootScope","loadingScreenService","cordovaReady","navigationService","securityTokenService","localizedNotificationService","loginServiceWrapper","userDataManager",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=!1,n=!1,o="/login/authError";this.registerEvents=function(){f.then(function(){document.addEventListener("backbutton",p,!1),document.addEventListener("pause",q,!1)}),h.registerTokenExpirationCallback(v),""!==c.path()&&"/login"!==c.path()||u()},d.$on("$locationChangeStart",function(a){n&&(a.preventDefault(),e.startLoadingWithTimeout(500,navigator.app.exitApp,"_Loading_Exit_"))});var p=function(a){a.preventDefault(),r()&&(n=!0,navigator.app.exitApp())},q=function(){console.log("app is paused"),l=c.path(),m=!0,e.startLoadingWithPromise(null,null,"_Loading_PleaseWait_"),s()},r=function(){var a=b.history.length<=1||"/home"===c.path()||"/login"===c.path()||c.path()===o;return a===!1&&console.log("history: "+history.length),a},s=function(){document.addEventListener("resume",t,!1)},t=function(){console.log("app resuming"),m=!1;var a=h.isTokenExpired();a?(console.log("token is expired"),e.startLoadingWithTimeout(1e3,w,"_Loading_TokenExpired_"),h.removeToken(),d.$apply()):(console.log("token is not expired"),g.goBack()),document.removeEventListener("resume",t,!1)},u=function(){if(h.tokenIsPresent()){console.log("token present");var a=j.initializeLoginIfTokenIsPresent();e.startLoadingWithPromise(a,y,"_Loading_Updating_")}},v=function(){console.log("Token is expired callback"),m!==!0&&x(!1)},w=function(){l!==o?g.goBack():x(!0)},x=function(a){a===!0?g.navigateAndReplace(o):g.navigate(o),k.setBackStackOfSessionAvailable(!0)},y=function(){g.navigateAndReplace("/home")}}]),angular.module("verklizan.umox.mobile.common").factory("appVersionLoader",["$window","$q","cachedLocalStorageService","localStorageKeys","supportingDataManagementServiceProxy","config","verklizanConfig","httpErrorCode","splashScreenService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){function b(a){return"v"===a[0]&&(a=a.substr(1)),a.split(".")}var c=b(a);this.versionArray=[],this.compareTo=function(a){for(var b=a.versionArray,c=0;c<this.versionArray.length;c++){var d=this.versionArray[c],e=b[c];if(d<e)return-1;if(d>e)return 1}return 0},this.toString=function(){var a="v";return a+=this.versionArray.join(".")};for(var d=0;d<c.length;d++){var e=c[d];if(t(e)){var f=parseInt(e);this.versionArray.push(f)}}}var k={};k.tryLoadingCorrectAppVersion=function(){return l().then(function(a){var b=new j(a.ServiceContractVersion),c=m(b);return console.log(JSON.stringify(c)),q(c)})};var l=function(){return e.readContractVersion("umo app")},m=function(a){for(var b,c=p(),d=0;d<c.length;d++){var e=c[d];n(e,a)&&("undefined"==typeof b?b=e:o(e,b)&&(b=e))}return"undefined"==typeof b&&(b=c[0]),b},n=function(a,b){var c=a.compareTo(b);return c<=0},o=function(a,b){return b.compareTo(a)<0},p=function(){for(var a=[],b=0;b<f.supportedServices.length;b++){var c=new j(f.supportedServices[b]);a.push(c)}return a},q=function(c){return s(c),r(c)?(console.log("already on the correct version"),b.reject()):(i.turnOnSplashScreen(),a.location.replace("../../versions/"+c+"/index.html"),b.when())},r=function(a){return"undefined"!=typeof g.serviceVersionSupported&&g.serviceVersionSupported===a.toString()},s=function(a){c.setLocalStorageItem(d.lastUsedAppVersion,a)},t=function(a){return!isNaN(a)};return k}]),angular.module("verklizan.umox.mobile.subscriber").service("AutoCompleteDataManager",function(){"use strict";return function(a,b){this.searchPage=a,this.add=b}}),angular.module("verklizan.umox.mobile.common").service("autoCompleteService",["navigationService","$q",function(a,b){"use strict";var c=[];this.createAutoComplete=function(b,e,f,g){if("undefined"==typeof b||"undefined"==typeof e||"undefined"==typeof f)throw"Incorrectly implemented autoCompleter";var h={title:b,dataManager:e,callback:f,params:g,selectItem:function(b){a.goBack(),this.callback(b),d(this)},start:function(){a.navigate("/autoComplete/"+this.index)},cancel:function(){a.goBack(),d(this)}};return h.index=c.push(h),h},this.getAutoCompleter=function(a){return a<0||a>c.length?null:c[a-1]},this.updateAutoCompleter=function(a){return!(a.index<0||a.index>c.length)&&(c[a.index-1]=a,!0)};var d=function(a){var b=c.indexOf(a);if(b<0)throw"object not found";return c.splice(b,1)}}]),angular.module("verklizan.umox.mobile.common").service("supportingDataManager",["$rootScope","webRequestService","userDataManager","supportingDataManagementServiceProxy","descriptors","pageSize","deviceManagementServiceProxy","subscriberManagementServiceProxy","hierarchyService","config","descriptorFactory","domainEnums",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(b,d,e){var f=this;this.includesOrganization=e,this.eventString=d,this.serviceOperation=b,this.data=[],this.isLoading=!1,this.allItemsLoaded=!1,this.pageIndex=0,this.loadingPromise=null,this.loadData=function(){return f.loadingPromise=g(),f.loadingPromise.then(function(){return f.data})},this.clearData=function(){this.data=[]};var g=function(a){if(f.isLoading!==!0&&f.allItemsLoaded!==!0){f.isLoading=!0,"undefined"==typeof a?a=f.pageIndex:f.pageIndex=a;var b,d=null;if(f.includesOrganization){var e=c.getUserOrganizationId(),g=new k.FilterOptionObject("OrganizationId",e,l.filterOperation.Equals);d=[g]}var j=k.readXXLargeData(a,d);return b=f.serviceOperation(j.filters,j.sort,j.pageDescriptor),b.then(function(b){return h(b,a)}).catch(function(){i()})}return f.loadingPromise},h=function(b,c){return f.data.push.apply(f.data,b.Rows),a.$broadcast(f.eventString,f.data),f.isLoading=!1,b.TotalCount>f.data.length?g(c+1):(console.log("Supporting data is loaded: "+f.eventString),void(f.allItemsLoaded=!0))},i=function(){f.loadingPromise=null,f.isLoading=!1}}function n(){return{readsubscriberstatepage:new m(h.readSubscriberStatePage,"supportingDataManager::subscriberStatesUpdated",!0),readdevicestatepage:new m(g.readDeviceStatePage,"supportingDataManager::newDeviceStateUpdated",!0),readorganizationpage:new m(d.readOrganizationPage,"supportingDataManager::organizationsUpdated",!1)}}function o(a,b,c){var d=[new e.filterDescriptorItem("OrganizationId",b,l.filterOperation.Equals)];window.isNullOrUndefinedOrEmpty(a)===!1&&d.push(new e.filterDescriptorItem("Name",a,l.filterOperation.StartsWith));var g=new e.filterDescriptor(d,l.filterOperation.And);return{pageDescriptor:new e.pageDescriptor(c,f.Small),filters:g,sort:new e.sortDescriptor(!0,"Name")}}var p=n();this.init=function(){c.sessionIsFreshStart()?(console.log("reload data"),r(),s()):(console.log("only check the data"),s())},this.getSubscriberStates=function(){return p.readsubscriberstatepage.loadData()},this.getNewDeviceStatusses=function(){return p.readdevicestatepage.loadData()},this.getCities=function(a,b,c){var e=o(a,b,c);return d.readCityPage(e.filters,e.sort,e.pageDescriptor)},this.getRegions=function(a,b,c){var e=o(a,b,c);return d.readRegionPage(e.filters,e.sort,e.pageDescriptor)},this.getLanguages=function(){return t()},this.getDeviceState=function(a){for(var b=q(p.readdevicestatepage),c=0;c<b.length;c++){var d=b[c];if(d.Name===a)return d.Id}return""},this.getOrganizations=function(a){var b=p.readorganizationpage.data;if(0===b.length&&p.readorganizationpage.loadData(),b&&a===!0){var c=[];angular.forEach(b,function(a){a.ParentId&&c.push(a)}),b=c}return b},this.getOrganizationsHierarchyTree=function(){var a=q(p.readorganizationpage);return i.buildHierarchy(a,"Name")};var q=function(a){return 0===a.data.length&&a.loadData(),a.data},r=function(){p=n()},s=function(){angular.forEach(p,function(a,b){a.loadData()})},t=function(){var a=[];for(var b in j.supportedLanguages)a.push({code:b,value:j.supportedLanguages[b].language});return a}}]),function(){var a,b=window.localStorage.getItem("Language");switch(b){case"nl":a="bower_components/angular-i18n/angular-locale_nl.js";break;case"en":a="bower_components/angular-i18n/angular-locale_en-gb.js"}a&&($.holdReady(!0),$.getScript(a,function(){$.holdReady(!1)}))}(),angular.module("verklizan.umox.mobile.common").service("listSelectorService",["$q","navigationService",function(a,b){"use strict";var c,d;this.callSelector=function(e,f,g,h){c={dataSetPromise:a.when(f),filters:h|{}},d=g,b.navigate("/listSelector/"+e)},this.getControllerData=function(){return c},this.selectItem=function(a){b.goBack(),d(a),e()};var e=function(){c=null,d=null}}]),angular.module("verklizan.umox.mobile.common").service("loadingScreenService",["$q","$rootScope","$location","$timeout","navigationService",function(a,b,c,d,e){"use strict";function f(b,c,d,f){g(d,f),b=a.when(b),b.then(function(a){angular.isFunction(c)&&c(a)}).catch(function(){e.goBack()})}function g(a,b){var d=c.path();d.indexOf(h)!==-1||b===!0?e.navigateAndReplace(h+a):e.navigate(h+a)}var h="/loading/";this.startLoadingWithTimeout=function(a,b,c){var e=d(function(){},a);f(e,b,c,!1)},this.startAndReplaceLoadingWithTimeout=function(a,b,c){var e=d(function(){},a);f(e,b,c,!0)},this.startLoadingWithPromise=function(a,b,c){f(a,b,c,!1)}}]),angular.module("verklizan.umox.mobile.common").factory("localizedNotificationService",["$q","nativeNotificationService","localisationService",function(a,b,c){"use strict";var d={};d.alert=function(d,e,f){var g,h,i,j=[];return j.push(c.getLocalizedStringAsync(d).then(function(a){g=a})),j.push(c.getLocalizedStringAsync(e).then(function(a){h=a})),j.push(c.getLocalizedStringAsync(f).then(function(a){i=a})),a.all(j).then(function(){return b.alert(g,h,i)})},d.confirm=function(d,f,g){var h,i,j,k=[];k.push(c.getLocalizedStringAsync(d).then(function(a){h=a})),k.push(c.getLocalizedStringAsync(f).then(function(a){i=a})),k.push(c.getLocalizedStringAsync(g).then(function(a){j=a}));var l=a.all(k).then(function(){return b.confirm(h,i,j)});return e(l)};var e=function(a){return window.isNullOrUndefined(a.ok)&&(a.ok=a.then),window.isNullOrUndefined(a.cancel)&&(a.cancel=a.catch),a};return d}]),angular.module("verklizan.umox.mobile.common").factory("domainModel",function(){"use strict";var a={};return a.pushSubscriptionType={Unknown:0,CareRequests:1,FaceTime:2},a.filterOperator={And:0,Or:1},a.filterOperation={InvalidOperation:0,Equals:1,Not:2,Like:3,Greater:4,Smaller:5,NotNULL:6,In:7,IsNULL:8,OnDate:9,StartsWith:10,EndsWith:11},a.caregiverCategory={Unknown:0,Professional:1,Relational:2,Warden:4,ProfessionalAsRelational:8},a.careRequestStatus={Unknown:0,Send:1,RequestReceived:2,Accept:3,Decline:4,Arrived:5,Done:6,DeviceNotReachable:7,Cancelled:8,Closed:9},a.linkingType={Unknown:0,None:1,Subscriber:2,Residence:3,Scheme:4},a.pageDescriptor=function(a,b){this.PageIndex=a,this.PageSize=b},a.filterDescriptorItem=function(a,b,c){this.__type="FilterDescriptor:www.verklizan.com",this.FilterProperty=[a],this.FilterValue=b,this.Operation=c},a.filterDescriptor=function(a,b){this.List=a,this.Operator=b},a.sortDescriptor=function(a,b){this.List=[{Direction:a?1:2,SortProperty:[b]}]},a.subscriberNote=function(a,b,c,d,e,f){this.PersonId=a,this.Subject=b,this.Content=c,this.IsEditDataRequired=d,this.IsPopUp=e,this.ValidPeriod="",f&&(this.DefaultAttachment=f,this.DefaultAttachmentMimeType="image/jpeg",this.DefaultAttachmentName="")},a.organizationNote=function(a,b,c,d,e){this.CompanyId=a,this.Subject=b,this.Content=c,this.ValidPeriod={FromDate:d,ToDate:e}},a.subscriber=function(a,b,c,d,e,f){this.Identity={FirstName:a.firstName,Insertion:a.insertion,Gender:a.gender,BirthDate:b,LastName:a.surname},this.CitizenServiceNumber=a.serviceNr,this.DefaultRemark=a.remark,this.SubscriberStateId=c,this.OrganizationId=d,this.SubscriptionNumber=e,this.ResidenceId=f,this.SocialServiceNumber={}},a.residence=function(a,b,c,d,e,f,g){this.StreetAddress={HouseNumber:a,StreetName:b,CityId:c,RegionId:d,PostalCode:e},this.DefaultPhoneNumber=f,this.OrganizationId=g,this.StreetAddressId="00000000-0000-0000-0000-000000000000"},a.urlObject=function(a,b,c){this.host=a,this.port=b,this.path=c},a}),angular.module("verklizan.umox.mobile.common").constant("httpErrorCode",{
Unknown:-1,NoConnection:0,BadRequest:400,NotAuthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,InternalServerError:500,ServiceUnavailable:503}),angular.module("verklizan.umox.mobile.common").factory("RejectedResult",function(){function a(a,b,c,d){this.errorIsHandled=a,this.response=b,this.message=c,this.messageIsLocalized=d,this.hasLocalizedMessage=function(){return this.messageIsLocalized===!0&&this.message}}return a}),angular.module("verklizan.umox.mobile.common").factory("supportingDataManagementServiceRequestModel",["pageSize","domainModel",function(a,b){"use strict";var c={};return c.readorganizationnotepage=function(a,c,d,e){var f=null;if(null!==c){var g=[new b.filterDescriptorItem("ValidPeriod.FromDate",c,b.filterOperation.Greater)];f=new b.filterDescriptor(g,b.filterOperator.And)}return{organizationId:a,pageDescriptor:new b.pageDescriptor(d,e),filters:f,sort:new b.sortDescriptor(!1,"SortIndex")}},c.createorganizationnote=function(a,c,d,e,f){return{note:new b.organizationNote(a,c,d,e,f)}},c.readNewOrganizationMessageCount=function(a){return{currentSortIndex:a}},c.readcitypage=function(c,d){var e;if(d){var f=[new b.filterDescriptorItem("OrganizationId",d,b.filterOperation.Equals),new b.filterDescriptorItem("Selectable",!0,b.filterOperation.Equals)];e=new b.filterDescriptor(f,b.filterOperator.And)}return{pageDescriptor:new b.pageDescriptor(c,a.XXLarge),filters:e,sort:null}},c.readregionpage=function(c,d){var e;if(d){var f=[new b.filterDescriptorItem("OrganizationId",d,b.filterOperation.Equals)];e=new b.filterDescriptor(f,b.filterOperator.And)}return{pageDescriptor:new b.pageDescriptor(c,a.Large),filters:e,sort:null}},c.readorganizationpage=function(b){return c.createSimpleRequestData(b,a.Large)},c.createSimpleRequestData=function(a,c){return{pageDescriptor:new b.pageDescriptor(a,c),filters:null,sort:null}},c.readContractVersion=function(a){return{client:a}},c}]),angular.module("verklizan.umox.mobile.common").service("navigationService",["$rootScope","$location","$route","$window","cordovaReady",function(a,b,c,d,e){"use strict";function f(a,b){this.path=a,this.params=b||{},this.toString=function(){if(!this.path)return"";var a=this.params;return this.path.replace(/\/(:.+?)\//g,function(b,c){var d=c.replace(":","");return"undefined"!=typeof a[d]?"/"+a[d]+"/":b})},this.isSamePageAs=function(a){var b=JSON.stringify(this),c=JSON.stringify(a);return b===c}}var g=this;e.then(function(){i()}),this.navigate=function(a,b){console.log("navigate to: "+a);var c=new f(a,b);h(c)},this.navigateAndReplace=function(a,b){console.log("navigate and replace to: "+a);var c=new f(a,b);h(c).replace()},this.getCurrentPage=function(){return b.path()},this.reloadCurrentPage=function(){c.reload()},this.goHome=function(){c.updateParams({state:""}),this.navigate("/home")},this.goBack=function(){console.log("Navigate: back"),d.history.back()},this.goBackMultiplePages=function(a){console.log("Navigate: back multiple pages: "+a),d.history.go(-a)};var h=function(a){if(a instanceof f)return b.path(a.toString())},i=function(){document.addEventListener("backbutton",j,!1)},j=function(a){a.preventDefault(),g.goBack()}}]),angular.module("verklizan.umox.mobile.common").service("organizationSettingsService",["$q","userSettingsService","settingsService","settingsServiceProxy","objectFieldUtilityService",function(a,b,c,d,e){"use strict";function f(a){p["get"+a]=function(){return g(a)},p["set"+a]=function(b){i(a,b)},p["clear"+a]=function(){j(a)},p["is"+a+"OrganizationSetting"]=function(){return k(a)}}function g(a){var b=l(a);return null===b?h(a):b}function h(a){return b["get"+a]()}function i(a,c){b["set"+a](c)}function j(a){b["clear"+a]()}function k(a){var b=l(a);return null!==b&&"undefined"!=typeof b}function l(a){var b=q[a];if(!b)throw"Setting id "+a+" is not known";var c=e.getFieldValue(o,b.dtoIdentifier);return null!==c?c:b.defaultValue}function m(a){c.setAppearanceSettings(a)}function n(a,b){this.dtoIdentifier=a,this.defaultValue=b||null}var o,p=this,q={SubscriberStatus:new n("NewSubscriberSettings.NewSubscriberDefaultStatus"),NewDeviceStatus:new n("LinkDeviceSettings.DeviceLinkDefaultStatus"),UnlinkDeviceStatus:new n("LinkDeviceSettings.DeviceUnlinkDefaultStatus"),AllowAddSubscriberInResponder:new n("ResponderUsabilitySettings.AllowAddSubscriberInResponder",!0),ShowMedicalTabSheetInResponder:new n("ResponderUsabilitySettings.ShowMedicalTabSheetInResponder",!0),AllowChangeDeviceLinkInResponder:new n("ResponderUsabilitySettings.AllowChangeDeviceLinkInResponder",!0),SaveUsernameAfterLoginInResponder:new n("ResponderUsabilitySettings.SaveUsernameAfterLoginInResponder",!0),AllowSearchSubscriberInResponder:new n("ResponderUsabilitySettings.AllowSearchSubscriberInResponder",!0),CareRequestHistoryLengthDaysInResponder:new n("ResponderUsabilitySettings.CareRequestHistoryLengthDaysInResponder",7),AllowAddNotesInResponder:new n("ResponderUsabilitySettings.AllowAddNotesInResponder",!0),OrganizationLogo:new n("ResponderAppearance.LogoBase64"),OrganizationLogoMimetype:new n("ResponderAppearance.LogoMimeType"),ShowBannerBehindLogo:new n("ResponderAppearance.BannerVisible",!0),AllowActionArrived:new n("CareRequestBusinessSettings.AllowResponderToSetArrived"),AllowActionDone:new n("CareRequestBusinessSettings.AllowResponderToSetDone"),AllowActionDoneIfNotYetArrived:new n("CareRequestBusinessSettings.ResponderActionDoneSetsArrived")};for(var r in q)f(r);this.loadOrganizationSettings=function(){return s()},this.getOrganizationSettings=function(){return o?a.when(o):s()};var s=function(){return d.getResponderSettings().then(function(a){o=a,m(o.ResponderAppearance)})}}]),angular.module("verklizan.umox.mobile.common").service("organizationTreeBuilderService",["supportingDataManager",function(a){"use strict";function b(a,b,c){this.Id=a.Id,this.Name=d(c)+a.Name,this.IdArray=b,this.OriginalOrganisation=a}function c(a,d,h,i){h[0]=a.value.Id,g.push(new b(a.value,h,d));var j=f;f++;for(var k=0,l=0;l<a.children.length;l++)a.children[l].value.IsScheme===!1&&(0===k&&(d++,i=0,k=1),i++,h[i]=[],c(a.children[l],d,h[i],i));g[j].IdArray=e(h,[])}function d(a){for(var b="",c=0;c<a;c++)b+=">";return b}function e(a,b){b.push(a[0]);for(var c=1;c<a.length;c++)e(a[c],b);return b}var f,g,h;this.getOrganizationTreeView=function(){if(h=a.getOrganizationsHierarchyTree())return g=[],f=0,c(h,0,[],1),g}}]),String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1},angular.module("verklizan.umox.mobile.common").factory("uiMapHelperService",["$rootScope","$q","localizedNotificationService","geolocationService","userSettingsService",function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l={};l.initializeMap=function(a,c){return f=new google.maps.DirectionsRenderer,g=new google.maps.DirectionsService,i=c,j=b.defer(),k=a,m(),j.promise};var m=function(){console.log("initializes the map"),f.setMap(k);var a={enableHighAccuracy:!0,timeout:1e4};d.getCurrentPosition(a).then(function(a){t(),h=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),n()}).catch(o)},n=function(){if(!h||!i)return void q("_Alerts_MapRouteNotFound_");var a={origin:h,destination:i,travelMode:google.maps.TravelMode.DRIVING};g.route(a,function(a,b){switch(b){case google.maps.DirectionsStatus.OK:k.setCenter(h),k.setZoom(17),k.setMapTypeId(google.maps.MapTypeId.ROADMAP),k.setOptions({disableDefaultUI:!0}),f.setDirections(a);break;case google.maps.DirectionsStatus.NOT_FOUND:q("_Alerts_MapRouteNotFound_");break;case google.maps.DirectionsStatus.ZERO_RESULTS:q("_Alerts_MapRouteNoResult_");break;default:q("_Alerts_MapRouteError_")}r(),s(),p()})},o=function(a){switch(a.code){case a.POSITION_UNAVAILABLE:case a.TIMEOUT:case a.PERMISSION_DENIED:q("_Alerts_MapPositionUnavailable_");break;default:q("_Alerts_MapLocationError_")}},p=function(){j.resolve()},q=function(a){var b={localizedErrorMessage:a};j.reject(b)},r=function(){google.maps.event.trigger(k,"resize")},s=function(){f=null,g=null,h=null,i=null,k=null},t=function(){e.clearLocationUnavailableMessageIsShown()};return l}]),angular.module("verklizan.umox.mobile.common").service("userSettingsService",["settingsService","userDataManager",function(a,b){"use strict";function c(a){this.userId=a,this.settings={}}function d(a){l["get"+a]=function(){return e(a)},l["set"+a]=function(b){f(a,b)},l["clear"+a]=function(){g(a)}}function e(a){var b=h();return b.settings[a]}function f(a,b){var c=h();c.settings[a]=b,k(c)}function g(a){var b=h();b.settings[a]="",k(b)}function h(){var c=a.getUserSettings();if(!c||i(c)){var d=b.getUserId();c=j(d)}return c}function i(a){var c=b.getUserId();return b.isAuthorized()&&c!==a.userId}function j(a){var b=new c(a);return k(b),b}function k(b){return a.setUserSettings(b)}for(var l=this,m=["SubscriberStatus","NewDeviceStatus","UnlinkDeviceStatus","LastSeenOrganizationNoteIndex","RecentSubscriberViews","PushTelNumber","PushIsEnabled","FaceTimeId","IsFaceTimeEnabled","LocationUnavailableMessageIsShown","IsInDebugMode","AutoCareRequestEnabled","AutoCareRequestInterval"],n=0;n<m.length;n++){var o=m[n];d(o)}}]),angular.module("verklizan.umox.mobile.common").service("webRequestService",["$http","$q","securityTokenService","generalConstants",function(a,b,c,d){"use strict";function e(a,b){return a.handleAuthorizationError(b)}var f=1e3*d.defaultServiceRequestTimeoutInSeconds;this.getWithCustomUrl=function(b,d,i,j){function k(a){return j.handleError(a)}var l=c.getHeader();return h(i,l)?a.get(b,{params:d,timeout:f},l).then(g).catch(k):i?e(j,b):a.get(b,{params:d,timeout:f}).catch(k)},this.postWithCustomUrl=function(b,d,i,j){function k(a){return j.handleError(a,d)}var l=c.getHeader(),m={timeout:f};return h(i,l)?(angular.merge(l,m),a.post(b,d,l).then(g).catch(k)):i?e(j,b):a.post(b,d,m).catch(k)};var g=function(a){return c.renewTokenExpiration(),a},h=function(a,b){var c=a===!0,d=!!b;return c&&d}}]),angular.module("verklizan.umox.mobile.messages").controller("messagesController",["$scope","messageDataManager","navigationService","userSettingsService","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e,f){"use strict";a.messagesViewModel=new e(e.pageSizes.Normal),a.messages=null,a.lastSeenMessage=d.getLastSeenOrganizationNoteIndex(),a.$on("$viewContentLoaded",function(){a.loadMoreMessages()}),a.loadMoreMessages=function(){var c=b.loadMessages(!1,a.messagesViewModel.nextPageNumber).then(g);f.addLoadingPromise(c)},a.toNewMessage=function(){c.navigate("/newMessage")},a.toDetailMessage=function(a){c.navigate("messages/0/"+a)};var g=function(b){a.messagesViewModel.addData(b),d.setLastSeenOrganizationNoteIndex(a.messagesViewModel.data[0].SortIndex)}}]),angular.module("verklizan.umox.mobile.messages").controller("messagesDetailController",["$scope","$routeParams","messageDataManager","navigationService","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";function f(){var a=h(b.isToday),d=c.loadMessage(a,parseInt(b.index)).then(g);e.addLoadingPromise(d)}function g(b){a.message=b}function h(a){return"1"===a}a.message=null,a.toNewMessage=function(){d.navigate("/newMessage")},a.$on("$viewContentLoaded",function(){f()})}]),angular.module("verklizan.umox.mobile.messages").controller("newMessageController",["$scope","messageDataManager","organizationTreeBuilderService","fieldLengthConstants","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";a.submitted=!1,a.organizations=c.getOrganizationTreeView(),a.maxTitleFieldLength=d.noteTitle,a.newMessage={organization:"",subject:"",content:"",fromDate:new Date,toDate:""},a.addNewMessage=function(){console.log("new Message method called"),a.submitted=!0;var c=a.toDateIsValid();if(a.newMessageForm.$valid&&c){var d=b.createOrganizationNote(a.newMessage).then(f);e.addLoadingPromise(d)}},a.toDateIsValid=function(){var b=a.newMessage.toDate,c=a.newMessage.fromDate;return!(b&&b<c)},a.$on("supportingDataManager::organizationsUpdated",function(){a.organizations=c.getOrganizationTreeView()});var f=function(){history.back()}}]),angular.module("verklizan.umox.mobile.messages").directive("diMessageListItem",function(){"use strict";return{restrict:"E",scope:{message:"=prMessageItem",prIsNew:"@"},templateUrl:"js/messages/directives/messageListItem.html",link:function(a){a.isNew="true"===a.prIsNew}}}),angular.module("verklizan.umox.mobile.messages").service("messageDataManager",["$rootScope","$q","userDataManager","userSettingsService","supportingDataManagementServiceProxy","dateExtensionService","descriptorFactory","domainEnums","organizationFactory","pageSize",function(a,b,c,d,e,f,g,h,i,j){"use strict";this.loadMessage=function(a,b){var d=(c.getUserOrganizationId(),j.Normal),e=Math.floor(b/d),f=b%d;return this.loadMessages(a,e).then(function(a){return a.Rows[f]})},this.loadMessages=function(a,d){var e=c.getUserOrganizationId();return angular.isDefined(e)?l(e,a,d):b.reject("no organization id")},this.createOrganizationNote=function(a){return a.organization&&a.organization.Id?k(a.organization,a.subject,a.content,a.fromDate,a.toDate):void console.error("no organization id")},this.getNewMessageCount=function(){var a=d.getLastSeenOrganizationNoteIndex();return a?e.readNewOrganizationMessageCount(a).then(function(a){var b=a;return b>99&&(b=99),b}):b.when(0)};var k=function(a,b,c,d,g){var h=f.convertDateToMsUtc(g),j=f.convertDateToMsUtc(d),k=i.createSimpleOrganizationNote(a.CompanyId,b,c,j,h);return e.createOrganizationNote(k)},l=function(a,b,c){var d=null;if(b){var f=m(),i=new g.FilterOptionObject("ValidPeriod.FromDate",f,h.filterOperation.Greater);d=i?[i]:null}var j=g.readNormalDataSortSortIndexDesc(c,d);return e.readOrganizationNotePage(j.filters,j.sort,j.pageDescriptor).then(function(a){var b=a;return b})},m=function(){var a=new Date,b=a.setHours(0,0,0,0);return b=new Date(b),f.convertDateToMsUtc(b)}}]),angular.module("verklizan.umox.mobile.subscriber").controller("newNoteController",["$scope","$routeParams","subscriberDataManager","cameraService","fieldLengthConstants","promiseLoadingSpinnerService","navigationService",function(a,b,c,d,e,f,g){"use strict";var h=b.id;a.submitted=!1,a.subscriberInfo=null,a.base64StringPrefix="data:image/jpeg;base64,",a.maxTitleFieldLength=e.noteTitle,a.newNote=c.newNoteCache||{subject:"",content:"",photo:"",callcenterNote:!1,crmNote:!1},a.$on("$viewContentLoaded",function(){i()}),a.addNewNote=function(){if(console.log("new Note method called"),a.submitted=!0,a.newNoteForm.$valid){var b=c.createNote(h,a.newNote).then(k);f.addLoadingPromise(b)}},a.setPicture=function(){j();var b={returnAsBytes:!0,targetWidth:1e3,targetHeight:1e3,correctOrientation:!0},c=d.getPicture(b).then(function(b){a.newNote.photo=b,console.log("succes camera")}).catch(function(a){console.log("error camera: "+a)});f.addLoadingPromise(c),console.log("set picture method called")};var i=function(){c.getSubscriberInfo(h).then(function(b){a.subscriberInfo=b})},j=function(){c.newNoteCache=a.newNote},k=function(){g.goBack()}}]),angular.module("verklizan.umox.mobile.subscriber").controller("newSubscriberProfileController",["$scope","navigationService","localisationService","newSubscriberDataManager","supportingDataManager","organizationTreeBuilderService","genderValues",function(a,b,c,d,e,f,g){"use strict";function h(b){var d=a.genderValues[b];c.getLocalizedStringAsync(d.localisationString).then(function(a){d.value=a})}a.bsnPattern=/^\d{9}$/,a.organizations=f.getOrganizationTreeView(),a.genderValues=[{id:g.Unknown,localisationString:"_Unknown_"},{id:g.Male,localisationString:"_Male_"},{id:g.Female,localisationString:"_Female_"}],a.newSubscriber=d.getNewSubscriberProfileInfo()||{surname:"",insertion:"",firstName:"",gender:0,organizationId:"",serviceNr:"",remark:"",birthDate:""},a.$on("$viewContentLoaded",function(){for(var b=0;b<a.genderValues.length;b++)h(b)}),a.submitFirstPage=function(){a.newSubscriberForm.$setSubmitted(),a.newSubscriber.surname&&a.newSubscriber.organizationId?(d.setNewSubscriberProfileInfo(a.newSubscriber),b.navigate("/newSubscriber/residence")):console.log("data is not valid or incomplete")},a.$on("supportingDataManager::organizationsUpdated",function(){a.organizations=f.getOrganizationTreeView()}),a.$on("$routeChangeStart",function(a,b){"partials/homePage.html"===b.$$route.templateUrl&&(d.setNewSubscriberProfileInfo(null),d.setNewSubscriberResidenceInfo(null))})}]),angular.module("verklizan.umox.mobile.subscriber").controller("newSubscriberResidenceController",["$scope","navigationService","newSubscriberDataManager","promiseLoadingSpinnerService",function(a,b,c,d){"use strict";a.invalidCity=!1,a.invalidRegion=!1,a.groupedCities=[],a.newResidence=c.getNewSubscriberResidenceInfo()||{street:"",houseNr:null,postcode:"",city:"",region:"",phone:null},a.selectCity=function(){c.setNewSubscriberResidenceInfo(a.newResidence),c.selectCity()},a.selectRegion=function(){c.setNewSubscriberResidenceInfo(a.newResidence),c.selectRegion()},a.addNewSubscriber=function(){if(a.newSubscriberForm.$setSubmitted(),a.invalidCity=!1,a.invalidRegion=!1,a.newResidence.street&&a.newResidence.city&&a.newResidence.phone){var b=c.setResidenceInfoAndCreateNewSubscriber(a.newResidence).then(e);d.addLoadingPromise(b)}};var e=function(a){b.navigateAndReplace("/subscriberPage/"+a+"/profile")}}]),angular.module("verklizan.umox.mobile.subscriber").controller("searchSubscriberResultsController",["$scope","$routeParams","searchSubscriberDataManager","navigationService","recentViewsDataManager","EndlessScrollPagingComponent","promiseLoadingSpinnerService","subscriberDataManager","organizationSettingsService",function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){h.clearCachedData(),d.navigate("/subscriberPage/"+a+"/profile")}function k(a){m.addData(a)}function l(a){var b=a.replace(/\//g,"-");return b}var m=new f(f.pageSizes.Normal);a.allowSearchSubscriberInResponder=i.getAllowSearchSubscriberInResponder(),a.searchSubscribersViewModel=m,a.searchText=b.searchText,a.submitted=!1,a.recentViews=e.getRecentViews(),a.userHasPushedSearchButton=!1,a.$on("$viewContentLoaded",function(){a.searchText&&a.getSearchSubscriberData()}),a.selectSubscriber=function(a){j(a.Id)},a.navigateToRecentView=function(a){j(a.id)},a.getMore=function(){a.getSearchSubscriberData()},a.getSearchSubscriberData=function(){if(!g.getIsLoading()){a.userHasPushedSearchButton=!0;var b=c.searchSubscribers(a.searchText,m.nextPageNumber,m.pageSize).then(k);g.addLoadingPromise(b)}},a.searchSubscribers=function(){if(a.submitted=!0,a.searchSubscriberForm.$valid&&a.searchText!==b.searchText){var c="/searchSubscriberResults/"+l(a.searchText);b.searchText?d.navigateAndReplace(c):d.navigate(c)}}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageAlarmsController",["$scope","$routeParams","subscriberDataManager","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";a.subscriberId=b.id,a.profileInfo=null,a.alarmsViewModel=new d(d.pageSizes.Normal),a.$on("$viewContentLoaded",function(){c.getSubscriberInfo(b.id).then(f),a.getMoreAlarms()}),a.getMoreAlarms=function(){var b=c.getAlarmInfo(a.subscriberId,a.alarmsViewModel.nextPageNumber,a.alarmsViewModel.pageSize).then(g);e.addLoadingPromise(b)};var f=function(b){a.profileInfo=b},g=function(b){a.alarmsViewModel.addData(b)}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageCareController",["$q","$scope","$routeParams","subscriberDataManager","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e,f){"use strict";b.caregiversViewModel=new e(e.pageSizes.Large),b.profileInfo=null,b.$on("$viewContentLoaded",function(){var a=d.getSubscriberInfo(c.id).then(function(a){b.profileInfo=a});f.addLoadingPromise(a),b.loadMoreCaregivers()}),b.loadMoreCaregivers=function(){var a=[],e=d.getCaregiversInfo(c.id,b.caregiversViewModel.nextPageNumber,b.caregiversViewModel.pageSize).then(function(c){b.caregiversViewModel.addData(c);for(var d=0;d<c.TotalCount;d++)a.push(g(c.Rows[d]));f.addLoadingPromise(a)});f.addLoadingPromise(e)};var g=function(a){var b=d.getCaregiverPhoneNumbers(a.Id);return b.then(function(b){a._phoneNumbers=b}),b}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageDevicesController",["$scope","$routeParams","organizationSettingsService","navigationService","subscriberDataManager","deviceDataManager","supportingDataManager","localizedNotificationService","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g,h,i,j){"use strict";a.subscriberId=b.id,a.isLoading=j.getIsLoading,a.allowChangeDeviceLinkInResponder=c.getAllowChangeDeviceLinkInResponder(),a.profileInfo=null,a.linkedDevicesViewModel=new i(i.pageSizes.Small),a.searchedDevicesViewModel=new i(i.pageSizes.Small),a.searchText="",a.submitted=!1,a.$on("$viewContentLoaded",function(){var b=e.getSubscriberInfo(a.subscriberId).then(function(b){a.profileInfo=b});j.addLoadingPromise(b),g.getNewDeviceStatusses(),l(a.subscriberId)}),a.linkDevice=function(b){var c=f.linkDevice(a.subscriberId,a.profileInfo.ResidenceId,b).finally(k);j.addLoadingPromise(c)},a.searchDevices=function(){n()&&(a.submitted=!0,a.searchedDevicesViewModel=new i(i.pageSizes.Small),m())},a.searchMoreDevices=function(){m()};var k=function(){a.linkedDevicesViewModel.clear(),a.submitted=!1,l(a.subscriberId)},l=function(b){a.searchedDevicesViewModel.clear(),a.searchText="";var c=f.loadDeviceInformationPage(b,a.linkedDevicesViewModel.nextPageNumber,a.linkedDevicesViewModel.pageSize).then(function(b){a.linkedDevicesViewModel.addData(b)});j.addLoadingPromise(c)},m=function(){if(a.searchDevicesForm.$valid){var b=f.searchDevice(a.searchText,a.searchedDevicesViewModel.nextPageNumber,a.searchedDevicesViewModel.pageSize).then(function(b){a.searchedDevicesViewModel.addData(b)});j.addLoadingPromise(b)}},n=function(){return!(!c.getNewDeviceStatus()||!c.getUnlinkDeviceStatus())||(o(),!1)},o=function(){h.confirm("_Alerts_NoDeviceStatusSet_","_Alerts_NoDeviceStatusSet_Title_",["_Ok_","_Cancel_"]).ok(p)},p=function(){d.navigate("/settings")}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageFrameController",["$scope","$q","$sce","$routeParams","subscriberDataManager","promiseLoadingSpinnerService",function(a,b,c,d,e,f){"use strict";a.indexOfPage=d.index,a.iframeSource=null,a.iframeLoadingDeffered=b.defer(),a.$on("$viewContentLoaded",function(){f.addLoadingPromise(a.iframeLoadingDeffered.promise),e.getMedicalTeleMedicine(d.id).then(function(b){a.iframeSource=b[a.indexOfPage]})}),a.trustSrc=function(a){return c.trustAsResourceUrl(a)},window.frameIsLoaded=function(){console.log("frame is loaded"),a.iframeLoadingDeffered.resolve()}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageMapController",["$routeParams","$scope","subscriberDataManager","uiMapHelperService","launchNavigatorService","localizedNotificationService","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g){"use strict";var h,i,j=a.id;b.mapIsEnabled=!1,b.mapIsUnusable=!1,b.profileInfo=null,b.isLoading=g.getIsLoading,b.pageMessage="",b.$on("$viewContentLoaded",function(){var a=c.getSubscriberInfo(j).then(k);g.addLoadingPromise(a)}),b.goToExternalNavigation=function(){h.then(function(){e.navigate(i).catch(o)})};var k=function(a){b.profileInfo=a,b.profileInfo.ResidenceId?(h=c.getResidenceInfo(j,b.profileInfo.ResidenceId).then(l),g.addLoadingPromise(h)):q()},l=function(a){var c=a.StreetAddress;if(p(c)){var e=d.initializeMap(b.myMap,c.LongAddress).catch(n).finally(m);g.addLoadingPromise(e),i=c.LongAddress}else q()},m=function(){b.mapIsEnabled=!0},n=function(a){q(a.localizedErrorMessage)},o=function(a){console.error(a),q("_Alerts_NavigateError_")},p=function(a){return"undefined"!=typeof a&&""!==a},q=function(a){b.mapIsUnusable=!0,b.pageMessage=a||"_Alerts_MapRouteNotFound_"}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageMedsController",["$scope","$routeParams","navigationService","subscriberDataManager","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";a.medicalInfo=null,a.medicationInfo=null,a.profileInfo=null,a.teleMedicine=null,a.$on("$viewContentLoaded",function(){f(),g(),h(),i()}),a.navigateToTelemedicine=function(a){c.navigate("/subscriberPage/"+b.id+"/frame/"+a)};var f=function(){var c=d.getSubscriberInfo(b.id).then(function(b){a.profileInfo=b});e.addLoadingPromise(c)},g=function(){var c=d.getMedicalInfo(b.id).then(function(b){a.medicalInfo=b});e.addLoadingPromise(c)},h=function(){var c=d.getMedicationInfo(b.id).then(function(b){a.medicationInfo=b});e.addLoadingPromise(c)},i=function(){d.getMedicalTeleMedicine(b.id).then(function(b){a.teleMedicine=b})}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageNoteDetailController",["$scope","$routeParams","$sce","subscriberDataManager","promiseLoadingSpinnerService",function(a,b,c,d,e){"use strict";var f=b.id,g=b.noteId;a.profileInfo=null,a.noteDetailInfo=null,a.noteDetailFormattedContent=null,a.imageUrl=null,a.isLoading=e.getIsLoading,a.$on("$viewContentLoaded",function(a){h(f),i(g)}),a.trustAsHtml=function(a){return c.trustAsHtml(a)};var h=function(b){var c=d.getSubscriberInfo(b).then(function(b){a.profileInfo=b});e.addLoadingPromise(c)},i=function(b){var c=d.getNoteDetailInfo(b).then(function(b){a.noteDetailInfo=b,a.noteDetailFormattedContent=a.trustAsHtml(b.Content),j(b.DefaultAttachment)});e.addLoadingPromise(c)},j=function(b){b&&(a.imageUrl="data:image/jpeg;base64,"+b)}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageNotesController",["$scope","$routeParams","$sce","navigationService","subscriberDataManager","EndlessScrollPagingComponent","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g){"use strict";var h=b.id;a.profileInfo=null,a.notesViewModel=new f(f.pageSizes.Normal),a.$on("$viewContentLoaded",function(){i(),a.loadMoreNotes()}),a.loadMoreNotes=function(){var b=e.getNotesInfo(h,a.notesViewModel.nextPageNumber,a.notesViewModel.pageSize).then(function(b){a.notesViewModel.addData(b)});g.addLoadingPromise(b)},a.trustAsHtml=function(a){return c.trustAsHtml(a)},a.navigateToNoteDetail=function(a){var b="/subscriberPage/"+h+"/notes/"+a;d.navigate(b)};var i=function(){var b=e.getSubscriberInfo(h).then(function(b){a.profileInfo=b});g.addLoadingPromise(b)}}]),angular.module("verklizan.umox.mobile.subscriber").controller("subscriberPageProfileController",["$q","$scope","$routeParams","navigationService","subscriberDataManager","recentViewsDataManager","RecentSubscriber","promiseLoadingSpinnerService",function(a,b,c,d,e,f,g,h){"use strict";var i=c.id;b.profileInfo=null,b.residenceInfo=null,b.notesInfo=null,b.$on("$viewContentLoaded",function(){var b=j(),c=m(),d=l();h.addLoadingPromise(a.all([b,c,d]))}),b.toNotes=function(){d.navigate("/subscriberPage/"+c.id+"/notes")};var j=function(){return e.getSubscriberInfo(i).then(function(a){b.profileInfo=a,k(a);var c=a.ResidenceId;if(c)return e.getResidenceInfo(i,c)}).then(function(a){b.residenceInfo=a})},k=function(a){var b=new g(a.Id,a.Identity.ShortName);f.addRecentView(b)},l=function(){return e.getNotesInfo(i).then(function(a){b.notesInfo=a})},m=function(){return e.getSubscriberPhoneNumbers(i).then(function(a){b.subscriberPhoneNumbers=a})}}]),angular.module("verklizan.umox.mobile.subscriber").directive("diSubpagetab",["$location","$routeParams","navigationService","organizationSettingsService",function(a,b,c,d){"use strict";return{restrict:"A",templateUrl:"js/subscriber/directives/subpagetab.html",scope:{prHeaderIndex:"="},link:function(a,e,f){var g="../../shared/img/";a.pages=[{url:"profile",image:g+"subscriber-normal_72x72.png",active:g+"subscriber-active_72x72.png"},{url:"care",image:g+"caregivers-normal_72x72.png",active:g+"caregivers-active_72x72.png"},{url:"devices",image:g+"devices-normal_72x72.png",active:g+"devices-active_72x72.png"},{url:"alarms",image:g+"incidents-normal_72x72.png",active:g+"incidents-active_72x72.png"},{url:"map",image:g+"map-normal_72x72.png",active:g+"map-active_72x72.png"}],d.getShowMedicalTabSheetInResponder()&&a.pages.splice(2,0,{url:"meds",image:g+"medical-normal_72x72.png",active:g+"medical-active_72x72.png"}),a.isPageActive=function(a){var b=h(a);return c.getCurrentPage()===b},a.navigate=function(a){var b=h(a);c.navigateAndReplace(b)};var h=function(a){var c=b.id,d="/subscriberPage/"+c+"/"+a;return d}}}}]),angular.module("verklizan.umox.mobile.subscriber").filter("caregiverCategoryToText",["domainModel",function(a){"use strict";return function(b){return b===a.caregiverCategory.Professional?"_Caregiver_Professional_":b===a.caregiverCategory.Relational?"_Caregiver_Relational_":b===a.caregiverCategory.Warden?"_Caregiver_Warden_":b===a.caregiverCategory.ProfessionalAsRelational?"_Caregiver_ProfessionalAsRelational_":"_Caregiver_Unknown_"}}]),angular.module("verklizan.umox.mobile.subscriber").filter("cordovaDeviceToPushDevice",["domainEnums","deviceService","devicePlatformConstants",function(a,b,c){"use strict";return function(b){switch(b){case c.iOS:return a.operatingSystemType.iOS;case c.Android:return a.operatingSystemType.AndroidFcm;case c.WP7:case c.WP8:return a.operatingSystemType.WindowsPhone;default:return a.operatingSystemType.Unknown}}}]),angular.module("verklizan.umox.mobile.subscriber").filter("linkingTypeToImage",["domainModel",function(a){"use strict";return function(b){return b===a.linkingType.Subscriber?"../../shared/img/subscriber-normal_24x24.png":b===a.linkingType.Residence?"../../shared/img/residences-normal_24x24.png":b===a.linkingType.Scheme?"../../shared/img/carecenters-normal_24x24.png":void 0}}]),angular.module("verklizan.umox.mobile.subscriber").service("deviceDataManager",["$rootScope","organizationSettingsService","supportingDataManager","deviceManagementServiceProxy","contractManagementServiceProxy","userDataManager","descriptorFactory","domainEnums",function(a,b,c,d,e,f,g,h){"use strict";var i=null,j=2,k=3;this.loadDeviceInformationPage=function(a,b,c){return o(a,b,c)},this.searchDevice=function(a,b,c){return p(a,b,c)},this.linkDevice=function(a,d,e){if(i&&0===i.length)return l(a,e);if(i&&1===i.length){var f=i[0],g=c.getDeviceState(f.State),h=b.getUnlinkDeviceStatus();if(f.LinkingOfDevice===j)return m(f.Id,a,e,g,h);if(f.LinkingOfDevice===k)return n(f.Id,d,e,g,h)}};var l=function(a,c){var d=b.getNewDeviceStatus();if(d)return q(a,c,d)},m=function(a,b,c,d,e){return q(b,c,d).then(function(c){return console.log("new is linked"),r(b,a,e)}).then(function(a){console.log("old is unlinked")})},n=function(a,b,c,d,e){return s(b,c,d).then(function(c){return console.log("new is linked"),t(b,a,e)}).then(function(a){console.log("old is unlinked")})},o=function(a,b){var c=g.readNormalData(b);return d.readDevicesForSubscriberResidencePage(a,c.filters,c.sort,c.pageDescriptor).then(function(a){return i=a.Rows,a})},p=function(a,b,c){var e=f.getUserOrganizationId(),i=new g.FilterOptionObject("OrganizationId",e,h.filterOperation.Equals),j=new g.FilterOptionObject("State.ReadyForPlacement",!0,h.filterOperation.Equals),k=new g.FilterOptionObject("Contract",!0,h.filterOperation.IsNULL),l=g.readNormalData(b,[i,j,k]);return d.searchDevice(a,l.filters,l.sort,l.pageDescriptor)},q=function(a,b,c){return e.createSubscriberDeviceLink(a,b,c)},r=function(a,b,c){return e.deleteSubscriberDeviceLink(a,b,c)},s=function(a,b,c){return e.createResidenceDeviceLink(a,b,c)},t=function(a,b,c){return e.deleteResidenceDeviceLink(a,b,c)}}]),angular.module("verklizan.umox.mobile.subscriber").service("newSubscriberDataManager",["$rootScope","$q","organizationSettingsService","supportingDataManager","listSelectorService","residenceManagementServiceProxy","subscriberManagementServiceProxy","dateExtensionService","userDataManager","subscriberFactory","residenceFactory","AutoCompleteDataManager","autoCompleteService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=this,o={},p={};this.getNewSubscriberProfileInfo=function(){return o},this.getNewSubscriberResidenceInfo=function(){return p},
this.setNewSubscriberProfileInfo=function(a){o=a},this.setNewSubscriberResidenceInfo=function(a){p=a},this.selectCity=function(){m.createAutoComplete("_ListSelector_cities_",new l(d.getCities),s,v()).start()},this.selectRegion=function(){m.createAutoComplete("_ListSelector_regions_",new l(d.getRegions),t,v()).start()},this.setResidenceInfoAndCreateNewSubscriber=function(a){return this.setNewSubscriberResidenceInfo(a),o&&p?(console.log("Sending request for new Subscriber"),p.organizationId=v(),q().then(function(a){return console.log("succesfull added residence"),r(a)}).then(function(a){return console.log("succesfull added subscriber"),n.setNewSubscriberProfileInfo({}),n.setNewSubscriberResidenceInfo({}),a})):(console.error("profile info and residence info are not both submitted yet"),b.reject("profile info and residence info are not both submitted yet"))};var q=function(){var a=k.createSimpleResidence(p.houseNr,p.street,p.city.Id,u(),p.postcode,p.phone,p.organizationId);return f.createResidence(a)},r=function(a){var b=c.getSubscriberStatus();console.log("local status: "+b);var d=null;o.birthDate&&(d=h.convertDateToMs(o.birthDate));var e=j.createSimpleSubscriber(o,d,b,o.organizationId,null,a);return g.createSubscriber(e)},s=function(a){p.city=a},t=function(a){p.region=a},u=function(){if("undefined"!=typeof p.region)return p.region.Id},v=function(){return i.getUserOrganizationId()}}]),angular.module("verklizan.umox.mobile.subscriber").service("recentViewsDataManager",["userSettingsService",function(a){"use strict";this.addRecentView=function(c){var d=this.getRecentViews(),e=b(c.id,d);e!==-1&&d.splice(e,1),d.unshift(c),d.length>5&&d.pop(),a.setRecentSubscriberViews(d)},this.getRecentViews=function(){var b=a.getRecentSubscriberViews();return b||[]},this.clearRecentViews=function(){a.clearRecentSubscriberViews()};var b=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.id===a)return c}return-1}}]),angular.module("verklizan.umox.mobile.subscriber").service("searchSubscriberDataManager",["$rootScope","subscriberManagementServiceProxy","descriptorFactory",function(a,b,c){"use strict";this.searchSubscribers=function(a,d){var e=c.readNormalData(d);return b.searchSubscribers(a,e.filters,e.sort,e.pageDescriptor)}}]),angular.module("verklizan.umox.mobile.subscriber").service("subscriberDataManager",["$rootScope","$q","subscriberManagementServiceProxy","residenceManagementServiceProxy","incidentManagementServiceProxy","careProviderManagementServiceProxy","pageSize","incidentManagementServiceRequestModel","subscriberFactory","descriptorFactory",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l,m,n,o,p=this,q=!1,r=!1,s=!1,t=!1;this.newNoteCache=null,this.clearCachedData=function(){D()},this.getSubscriberInfo=function(a){return u(a),q===!1&&v(a),l.promise},this.getSubscriberPhoneNumbers=function(a){var b=j.readXXLargeData(0);return c.readSubscriberContactItemPage(a,b.filters,b.sort,b.pageDescriptor)},this.getResidenceInfo=function(a,b){return u(a),r===!1&&w(b),m.promise},this.getMedicalTeleMedicine=function(a){var b=/(MEDICAL\d=(.*))/g,d=j.readNormalData(0);return c.readSubscriberSoapNotePage(a,d.filters,d.sort,d.pageDescriptor).then(function(a){for(var c=a,d=[],e=0;e<c.Rows.length;e++)for(var f,g=c.Rows[e].Content;f=b.exec(g);){var h=f[2];0!==h.indexOf("http")&&(h="http://"+h),d.push(h)}return d})},this.getNotesInfo=function(a,b,c){return x(a,b,c)},this.getNoteDetailInfo=function(a){return c.readSubscriberHtmlNote(a)},this.getCaregiversInfo=function(a,b,c){return y(a,b,c)},this.getCaregiverPhoneNumbers=function(a){var b=j.readXXLargeData(0);return f.readProfessionalCaregiverContactItemPage(a,b.filters,b.sort,b.pageDescriptor)},this.getMedicalInfo=function(a){return u(a),s===!1&&z(a),n.promise},this.getMedicationInfo=function(a){return u(a),t===!1&&A(a),o.promise},this.getAlarmInfo=function(a,b){return B(a,b)},this.createNote=function(a,b){return this.newNoteCache=b,p.getSubscriberInfo(a).then(function(a){var c=a.Identity.Id;return C(c,b.subject,b.content,b.crmNote,b.callcenterNote,b.photo)})};var u=function(a){k!==a&&(D(),k=a)},v=function(a){return c.readSubscriber(a).then(function(a){q=!0,l.resolve(a)}).catch(function(a){l.reject(a)})},w=function(a){return d.readResidence(a).then(function(a){r=!0,m.resolve(a)}).catch(function(a){m.reject(a)})},x=function(a,b){var d=j.readNormalData(b);return c.readSubscriberHtmlNotePage(a,d.filters,d.sort,d.pageDescriptor)},y=function(a,b){var c=j.readNormalData(b);return f.readCaregiversForSubscriberResidenceSchemePage(a,c.filters,c.sort,c.pageDescriptor)},z=function(a){return c.readMedicalInfoPage(a).then(function(a){n.resolve(a)})},A=function(a){c.readMedicationPage(a).then(function(a){o.resolve(a)})},B=function(a,b){var c=h.createSortedRequestModel(b,g.Normal);return e.readIncidentPageForSubscriber(a,c.filters,c.sort,c.pageDescriptor)},C=function(a,b,d,e,f,g){var h=i.createSimpleSubscriberNote(a,b,d,e,f,g);return c.createSubscriberNote(h).then(function(a){p.newNoteCache=null})},D=function(){q=!1,r=!1,s=!1,t=!1,l=b.defer(),m=b.defer(),n=b.defer(),o=b.defer()}}]),angular.module("verklizan.umox.mobile.subscriber").factory("careProviderManagementServiceRequestModel",["domainModel","pageSize",function(a,b){"use strict";var c={};return c.readCaregiversForSubscriberResidenceSchemePage=function(b,c,d){return{subscriberId:b,pageDescriptor:new a.pageDescriptor(c,d),filters:null,sort:null}},c.readProfessionalCaregiverContactItemPage=function(c){return{caregiverId:c,pageDescriptor:new a.pageDescriptor(0,b.Large),filters:null,sort:null}},c}]),angular.module("verklizan.umox.mobile.subscriber").factory("contractManagementServiceRequestModel",function(){"use strict";var a={};a.createsubscriberdevicelink=function(a,c,d){return b(a,c,d)},a.deletesubscriberdevicelink=function(a,c,d){return b(a,c,d)};var b=function(a,b,c){return{subscriberId:a,deviceId:b,newDeviceStateId:c}};a.createresidencedevicelink=function(a,b,d){return c(a,b,d)},a.deleteresidencedevicelink=function(a,b,d){return c(a,b,d)};var c=function(a,b,c){return{residenceId:a,deviceId:b,newDeviceStateId:c}};return a}),angular.module("verklizan.umox.mobile.subscriber").factory("deviceManagementServiceRequestModel",["pageSize","domainModel",function(a,b){"use strict";var c={};return c.readdevicesforsubscriberresidencepage=function(a,c,d){return{subscriberId:a,pageDescriptor:new b.pageDescriptor(c,d),filters:null,sort:null}},c.searchdevice=function(a,c,d,e,f){var g=[];e&&g.push(new b.filterDescriptorItem("State.ReadyForPlacement",!0,b.filterOperation.Equals)),f&&g.push(new b.filterDescriptorItem("OrganizationId",f,b.filterOperation.Equals));var h=null;return 0!==g.length&&(h=new b.filterDescriptor(g,b.filterOperator.And)),{searchText:a,pageDescriptor:new b.pageDescriptor(c,d),filters:h,sort:new b.sortDescriptor(!0,"Code")}},c.readdevicestatepage=function(c,d){var e;if(d){var f=[new b.filterDescriptorItem("OrganizationId",d,b.filterOperation.Equals)];e=new b.filterDescriptor(f,b.filterOperator.And)}return{pageDescriptor:new b.pageDescriptor(c,a.Large),filters:e,sort:null}},c}]),angular.module("verklizan.umox.mobile.subscriber").factory("incidentManagementServiceRequestModel",["domainModel",function(a){"use strict";var b={};b.readincidentpageforsubscriber=function(a,b,d){return c(a,b,d)},b.createSortedRequestModel=function(a,b){return c(null,a,b)};var c=function(b,c,d){return{subscriberId:b,pageDescriptor:new a.pageDescriptor(c,d),filter:null,sort:new a.sortDescriptor(!1,"StartTime")}};return b}]),angular.module("verklizan.umox.mobile.subscriber").factory("RecentSubscriber",function(){"use strict";function a(a,b){this.id=a,this.name=b}return a}),angular.module("verklizan.umox.mobile.subscriber").factory("residenceManagementServiceRequestModel",["domainModel",function(a){"use strict";var b={};return b.readresidence=function(a){return{residenceId:a}},b.createresidence=function(b,c,d,e,f,g,h){return{residence:new a.residence(b,c,d,e,f,g,h)}},b}]),angular.module("verklizan.umox.mobile.subscriber").factory("subscriberManagementServiceRequestModel",["pageSize","domainModel",function(a,b){"use strict";var c={};return c.searchSubscribers=function(a,c,d){return{searchText:a,pageDescriptor:new b.pageDescriptor(c,d),filters:null,sort:null}},c.readsubscriber=function(a){return{subscriberId:a}},c.createsubscriber=function(a,c,d,e,f){return{subscriber:new b.subscriber(a,c,d,e,null,f)}},c.readsubscriberstatepage=function(c,d){var e;if(d){var f=[new b.filterDescriptorItem("OrganizationId",d,b.filterOperation.Equals)];e=new b.filterDescriptor(f,b.filterOperator.And)}return{pageDescriptor:new b.pageDescriptor(c,a.Large),filters:e,sort:null}},c.readmedicalinfopage=function(c){return{subscriberId:c,pageDescriptor:new b.pageDescriptor(0,a.Large),filters:null,sort:null}},c.readmedicationpage=function(c){return{subscriberId:c,pageDescriptor:new b.pageDescriptor(0,a.Large),filters:null,sort:null}},c.createsubscribernote=function(a,c,d,e,f,g){return{note:new b.subscriberNote(a,c,d,e,f,g)}},c.readsubscribernote=function(a){return{noteId:a}},c.readsubscribernotepage=function(a,c,d){return{subscriberId:a,pageDescriptor:new b.pageDescriptor(c,d),filters:null,sort:null}},c}]),angular.module("verklizan.umox.mobile.userInfo").service("userDataManager",["$rootScope","$q","$route","USER_ROLES","cachedLocalStorageService","securityTokenService","loginServiceProxy","userManagementServiceProxy","hashService","RejectedResult","careProviderManagementServiceProxy","userDataManagerService","contactItemTypeFunctionValues","descriptorFactory","domainEnums","descriptors",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q,r,s,t,u=this,v="OperatorId",w=d.empty;f.registerTokenExpirationCallback(function(){u.readCurrentOperator()}),this.readCurrentOperator=function(){return q?b.when(q):l.readCurrentUser().then(x)},this.getCurrentCaregiverPhoneNumbers=function(){var a=0,b=q.ProfessionalCaregiverIdentity.Id,c=new p.filterDescriptorItem("Type.FunctionValues",m.Unknown,o.filterOperation.Equals),d=new p.filterDescriptorItem("Type.FunctionValues",m.ExternalPhone,o.filterOperation.Equals),e=new p.filterDescriptorItem("Type.FunctionValues",m.SIP,o.filterOperation.Equals),f=new p.filterDescriptorItem("Type.FunctionValues",m.SmsAssist,o.filterOperation.Equals),g=new p.filterDescriptorItem("Type.FunctionValues",m.CareFollowUp,o.filterOperation.Equals),h=new p.filterDescriptorItem("Type.FunctionValues",m.CareApp,o.filterOperation.Equals),i=new p.filterDescriptorItem("Type.FunctionValues",m.Facetime,o.filterOperation.Equals),j=new p.filterDescriptor([c,d,e,f,g,h,i],o.filterOperator.Or),l=n.readLargeData(a);return k.readProfessionalCaregiverContactItemPage(b,j,l.sort,l.pageDescriptor)},this.requestPasswordReset=function(a){return h.requestPasswordReset(a)},this.resetPassword=function(a,b,c){var d=i.CreatePasswordHash(a,b);return h.resetPassword(a,d,c)},this.changePassword=function(a,b,c){var d=i.CreatePasswordHash(a,b),e=i.CreatePasswordHash(a,c);return h.changePassword(d,e)},this.resetCurrentOperator=function(){E(null),l.resetCurrentUser()},this.getUserOrganizationId=function(){return angular.isDefined(q.ProfessionalCaregiverIdentity)&&null!==q.ProfessionalCaregiverIdentity?q.ProfessionalCaregiverIdentity.OrganizationId:angular.isDefined(q.OperatorIdentity.OrganizationId)&&null!==q.OperatorIdentity.OrganizationId?q.OperatorIdentity.OrganizationId:void 0},this.isFirstLoginSinceAppStart=function(){return!!angular.isUndefined(s)||s},this.sessionIsFreshStart=function(){console.log("Back stack history session avaible: "+t);var a=this.isFirstLoginSinceAppStart(),b=!this.isFirstLoginSinceAppStart()&&!r,c=!t;return a||b||c},this.isAuthorized=function(){return null!==q&&"object"==typeof q},this.isAuthorizedForCurrentPage=function(){var a=c.current.data.authorizedRoles;return B(a)},this.getUserId=function(){if(q&&q.Person)return q.Person.Id},this.getCurrentUserRole=function(){return w||d.empty},this.getUserName=function(){return q.UserName},this.setBackStackOfSessionAvailable=function(a){t=a};var x=function(a){var b=a;return C(b),y(b)},y=function(a){E(a);z(a.Person.Id);return D(),a},z=function(a){return F()?r=A(a):(H(a),void(r=!0))},A=function(a){var b=G();return a===b||(H(a),!1)},B=function(a){return angular.isArray(a)||(a=[a]),a.indexOf(d.empty)!==-1||(a.indexOf(d.all)!==-1&&w!==d.empty||a.indexOf(w)!==-1)},C=function(a){var b=a.CacheTimeoutMinutes;f.setExperiationInMinutes(b)},D=function(){angular.isUndefined(s)?s=!0:s===!0&&(s=!1)},E=function(a){q=a,angular.isUndefined(a)||null===a?w=d.empty:null!==q.ProfessionalCaregiverIdentity?w=d.caregiver:null!==q.OperatorIdentity&&(w=d.operator)},F=function(){var a=G();return null!==a},G=function(){return e.getLocalStorageItem(v)},H=function(a){e.setLocalStorageItem(v,a)}}]),angular.module("verklizan.umox.mobile.userInfo").factory("userManagementServiceRequestModel",function(){var a={};return a.requestPasswordReset=function(a){return{email:a}},a.resetPassword=function(a,b,c){return{email:a,password:b,resetCode:c}},a.changePassword=function(a,b){return{oldPassword:a,newPassword:b}},a});